(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{7820:function(a){!function(){var b={449:function(a,b){"use strict";b.byteLength=function(a){var b=i(a),c=b[0],d=b[1];return(c+d)*3/4-d},b.toByteArray=function(a){var b,c,f,g,h,j=i(a),k=j[0],l=j[1],m=new e((g=k,(g+(h=l))*3/4-h)),n=0,o=l>0?k-4:k;for(c=0;c<o;c+=4)b=d[a.charCodeAt(c)]<<18|d[a.charCodeAt(c+1)]<<12|d[a.charCodeAt(c+2)]<<6|d[a.charCodeAt(c+3)],m[n++]=b>>16&255,m[n++]=b>>8&255,m[n++]=255&b;return 2===l&&(b=d[a.charCodeAt(c)]<<2|d[a.charCodeAt(c+1)]>>4,m[n++]=255&b),1===l&&(b=d[a.charCodeAt(c)]<<10|d[a.charCodeAt(c+1)]<<4|d[a.charCodeAt(c+2)]>>2,m[n++]=b>>8&255,m[n++]=255&b),m},b.fromByteArray=function(a){for(var b,d=a.length,e=d%3,f=[],g=0,h=d-e;g<h;g+=16383)f.push(k(a,g,g+16383>h?h:g+16383));return 1===e?f.push(c[(b=a[d-1])>>2]+c[b<<4&63]+"=="):2===e&&f.push(c[(b=(a[d-2]<<8)+a[d-1])>>10]+c[b>>4&63]+c[b<<2&63]+"="),f.join("")};for(var c=[],d=[],e="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,h=f.length;g<h;++g)c[g]=f[g],d[f.charCodeAt(g)]=g;function i(a){var b=a.length;if(b%4>0)throw Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");-1===c&&(c=b);var d=c===b?0:4-c%4;return[c,d]}function j(a){return c[a>>18&63]+c[a>>12&63]+c[a>>6&63]+c[63&a]}function k(a,b,c){for(var d,e=[],f=b;f<c;f+=3)e.push(j(d=(a[f]<<16&16711680)+(a[f+1]<<8&65280)+(255&a[f+2])));return e.join("")}d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},877:function(a,b,c){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */ var d=c(449),e=c(543),f="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function g(a){if(a>2147483647)throw RangeError('The value "'+a+'" is invalid for option "size"');var b=new Uint8Array(a);return Object.setPrototypeOf(b,h.prototype),b}function h(a,b,c){if("number"==typeof a){if("string"==typeof b)throw TypeError('The "string" argument must be of type string. Received type number');return k(a)}return i(a,b,c)}function i(a,b,c){if("string"==typeof a)return l(a,b);if(ArrayBuffer.isView(a))return m(a);if(null==a)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(S(a,ArrayBuffer)||a&&S(a.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(S(a,SharedArrayBuffer)||a&&S(a.buffer,SharedArrayBuffer)))return n(a,b,c);if("number"==typeof a)throw TypeError('The "value" argument must not be of type number. Received type number');var d=a.valueOf&&a.valueOf();if(null!=d&&d!==a)return h.from(d,b,c);var e=o(a);if(e)return e;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof a[Symbol.toPrimitive])return h.from(a[Symbol.toPrimitive]("string"),b,c);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}function j(a){if("number"!=typeof a)throw TypeError('"size" argument must be of type number');if(a<0)throw RangeError('The value "'+a+'" is invalid for option "size"')}function k(a){return j(a),g(a<0?0:0|p(a))}function l(a,b){if(("string"!=typeof b||""===b)&&(b="utf8"),!h.isEncoding(b))throw TypeError("Unknown encoding: "+b);var c=0|q(a,b),d=g(c),e=d.write(a,b);return e!==c&&(d=d.slice(0,e)),d}function m(a){for(var b=a.length<0?0:0|p(a.length),c=g(b),d=0;d<b;d+=1)c[d]=255&a[d];return c}function n(a,b,c){var d;if(b<0||a.byteLength<b)throw RangeError('"offset" is outside of buffer bounds');if(a.byteLength<b+(c||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(d=void 0===b&& void 0===c?new Uint8Array(a):void 0===c?new Uint8Array(a,b):new Uint8Array(a,b,c),h.prototype),d}function o(a){if(h.isBuffer(a)){var b,c=0|p(a.length),d=g(c);return 0===d.length||a.copy(d,0,0,c),d}if(void 0!==a.length){return"number"!=typeof a.length||(b=a.length,b!=b)?g(0):m(a)}if("Buffer"===a.type&&Array.isArray(a.data))return m(a.data)}function p(a){if(a>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|a}function q(a,b){if(h.isBuffer(a))return a.length;if(ArrayBuffer.isView(a)||S(a,ArrayBuffer))return a.byteLength;if("string"!=typeof a)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);var c=a.length,d=arguments.length>2&& !0===arguments[2];if(!d&&0===c)return 0;for(var e=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return N(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return Q(a).length;default:if(e)return d?-1:N(a).length;b=(""+b).toLowerCase(),e=!0}}function r(a,b,c){var d=!1;if((void 0===b||b<0)&&(b=0),b>this.length||((void 0===c||c>this.length)&&(c=this.length),c<=0||(c>>>=0)<=(b>>>=0)))return"";for(a||(a="utf8");;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"latin1":case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function s(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function t(a,b,c,d,e){var f;if(0===a.length)return -1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:c< -2147483648&&(c=-2147483648),f=c=+c,f!=f&&(c=e?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(e)return -1;c=a.length-1}else if(c<0){if(!e)return -1;c=0}if("string"==typeof b&&(b=h.from(b,d)),h.isBuffer(b))return 0===b.length?-1:u(a,b,c,d,e);if("number"==typeof b)return(b&=255,"function"==typeof Uint8Array.prototype.indexOf)?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):u(a,[b],c,d,e);throw TypeError("val must be string, number or Buffer")}function u(a,b,c,d,e){var f,g=1,h=a.length,i=b.length;if(void 0!==d&&("ucs2"===(d=String(d).toLowerCase())||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return -1;g=2,h/=2,i/=2,c/=2}function j(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}if(e){var k=-1;for(f=c;f<h;f++)if(j(a,f)===j(b,-1===k?0:f-k)){if(-1===k&&(k=f),f-k+1===i)return k*g}else -1!==k&&(f-=f-k),k=-1}else for(c+i>h&&(c=h-i),f=c;f>=0;f--){for(var l=!0,m=0;m<i;m++)if(j(a,f+m)!==j(b,m)){l=!1;break}if(l)return f}return -1}function v(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d))>e&&(d=e):d=e;var f=b.length;d>f/2&&(d=f/2);for(var g=0;g<d;++g){var h,i=parseInt(b.substr(2*g,2),16);if(h=i,h!=h)break;a[c+g]=i}return g}function w(a,b,c,d){return R(N(b,a.length-c),a,c,d)}function x(a,b,c,d){return R(O(b),a,c,d)}b.Buffer=h,b.SlowBuffer=function(a){return+a!=a&&(a=0),h.alloc(+a)},b.INSPECT_MAX_BYTES=50,b.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var a=new Uint8Array(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,Uint8Array.prototype),Object.setPrototypeOf(a,b),42===a.foo()}catch(c){return!1}}(),h.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(a,b,c){return i(a,b,c)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(a,b,c){var d,e,f;return d=a,e=b,f=c,(j(d),d<=0)?g(d):void 0!==e?"string"==typeof f?g(d).fill(e,f):g(d).fill(e):g(d)},h.allocUnsafe=function(a){return k(a)},h.allocUnsafeSlow=function(a){return k(a)};function y(a,b,c,d){return R(Q(b),a,c,d)}function z(a,b,c,d){return R(P(b,a.length-c),a,c,d)}function A(a,b,c){return 0===b&&c===a.length?d.fromByteArray(a):d.fromByteArray(a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f,g,h,i,j=a[e],k=null,l=j>239?4:j>223?3:j>191?2:1;if(e+l<=c)switch(l){case 1:j<128&&(k=j);break;case 2:(192&(f=a[e+1]))==128&&(i=(31&j)<<6|63&f)>127&&(k=i);break;case 3:f=a[e+1],g=a[e+2],(192&f)==128&&(192&g)==128&&(i=(15&j)<<12|(63&f)<<6|63&g)>2047&&(i<55296||i>57343)&&(k=i);break;case 4:f=a[e+1],g=a[e+2],h=a[e+3],(192&f)==128&&(192&g)==128&&(192&h)==128&&(i=(15&j)<<18|(63&f)<<12|(63&g)<<6|63&h)>65535&&i<1114112&&(k=i)}null===k?(k=65533,l=1):k>65535&&(k-=65536,d.push(k>>>10&1023|55296),k=56320|1023&k),d.push(k),e+=l}return C(d)}function C(a){var b=a.length;if(b<=4096)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=4096));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;++f)e+=T[a[f]];return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!=0||a<0)throw RangeError("offset is not uint");if(a+b>c)throw RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,e,f){if(!h.isBuffer(a))throw TypeError('"buffer" argument must be a Buffer instance');if(b>e||b<f)throw RangeError('"value" argument is out of bounds');if(c+d>a.length)throw RangeError("Index out of range")}function J(a,b,c,d,e,f){if(c+d>a.length||c<0)throw RangeError("Index out of range")}function K(a,b,c,d,f){return b=+b,c>>>=0,f||J(a,b,c,4,34028234663852886e22,-34028234663852886e22),e.write(a,b,c,d,23,4),c+4}function L(a,b,c,d,f){return b=+b,c>>>=0,f||J(a,b,c,8,17976931348623157e292,-17976931348623157e292),e.write(a,b,c,d,52,8),c+8}h.isBuffer=function(a){return null!=a&& !0===a._isBuffer&&a!==h.prototype},h.compare=function(a,b){if(S(a,Uint8Array)&&(a=h.from(a,a.offset,a.byteLength)),S(b,Uint8Array)&&(b=h.from(b,b.offset,b.byteLength)),!h.isBuffer(a)||!h.isBuffer(b))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);e<f;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:d<c?1:0},h.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(a,b){if(!Array.isArray(a))throw TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return h.alloc(0);if(void 0===b)for(c=0,b=0;c<a.length;++c)b+=a[c].length;var c,d=h.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var f=a[c];if(S(f,Uint8Array)&&(f=h.from(f)),!h.isBuffer(f))throw TypeError('"list" argument must be an Array of Buffers');f.copy(d,e),e+=f.length}return d},h.byteLength=q,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var a=this.length;if(a%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<a;b+=2)s(this,b,b+1);return this},h.prototype.swap32=function(){var a=this.length;if(a%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)s(this,b,b+3),s(this,b+1,b+2);return this},h.prototype.swap64=function(){var a=this.length;if(a%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)s(this,b,b+7),s(this,b+1,b+6),s(this,b+2,b+5),s(this,b+3,b+4);return this},h.prototype.toString=function(){var a=this.length;return 0===a?"":0===arguments.length?B(this,0,a):r.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(a){if(!h.isBuffer(a))throw TypeError("Argument must be a Buffer");return this===a||0===h.compare(this,a)},h.prototype.inspect=function(){var a="",c=b.INSPECT_MAX_BYTES;return a=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(a+=" ... "),"<Buffer "+a+">"},f&&(h.prototype[f]=h.prototype.inspect),h.prototype.compare=function(a,b,c,d,e){if(S(a,Uint8Array)&&(a=h.from(a,a.offset,a.byteLength)),!h.isBuffer(a))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),b<0||c>a.length||d<0||e>this.length)throw RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return -1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var f=e-d,g=c-b,i=Math.min(f,g),j=this.slice(d,e),k=a.slice(b,c),l=0;l<i;++l)if(j[l]!==k[l]){f=j[l],g=k[l];break}return f<g?-1:g<f?1:0},h.prototype.includes=function(a,b,c){return -1!==this.indexOf(a,b,c)},h.prototype.indexOf=function(a,b,c){return t(this,a,b,c,!0)},h.prototype.lastIndexOf=function(a,b,c){return t(this,a,b,c,!1)},h.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b>>>=0,isFinite(c)?(c>>>=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var e,f,g,h,i=this.length-b;if((void 0===c||c>i)&&(c=i),a.length>0&&(c<0||b<0)||b>this.length)throw RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var j=!1;;)switch(d){case"hex":return v(this,a,b,c);case"utf8":case"utf-8":return w(this,a,b,c);case"ascii":return x(this,a,b,c);case"latin1":case"binary":return e=this,f=a,g=b,x(e,f,g,h=c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(j)throw TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),j=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c)<0&&(a=0):a>c&&(a=c),b<0?(b+=c)<0&&(b=0):b>c&&(b=c),b<a&&(b=a);var d=this.subarray(a,b);return Object.setPrototypeOf(d,h.prototype),d},h.prototype.readUIntLE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},h.prototype.readUIntBE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a+ --b],e=1;b>0&&(e*=256);)d+=this[a+ --b]*e;return d},h.prototype.readUInt8=function(a,b){return a>>>=0,b||H(a,1,this.length),this[a]},h.prototype.readUInt16LE=function(a,b){return a>>>=0,b||H(a,2,this.length),this[a]|this[a+1]<<8},h.prototype.readUInt16BE=function(a,b){return a>>>=0,b||H(a,2,this.length),this[a]<<8|this[a+1]},h.prototype.readUInt32LE=function(a,b){return a>>>=0,b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},h.prototype.readUInt32BE=function(a,b){return a>>>=0,b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},h.prototype.readIntLE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d>=(e*=128)&&(d-=Math.pow(2,8*b)),d},h.prototype.readIntBE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+ --d];d>0&&(e*=256);)f+=this[a+ --d]*e;return f>=(e*=128)&&(f-=Math.pow(2,8*b)),f},h.prototype.readInt8=function(a,b){return(a>>>=0,b||H(a,1,this.length),128&this[a])?-((255-this[a]+1)*1):this[a]},h.prototype.readInt16LE=function(a,b){a>>>=0,b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},h.prototype.readInt16BE=function(a,b){a>>>=0,b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},h.prototype.readInt32LE=function(a,b){return a>>>=0,b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},h.prototype.readInt32BE=function(a,b){return a>>>=0,b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},h.prototype.readFloatLE=function(a,b){return a>>>=0,b||H(a,4,this.length),e.read(this,a,!0,23,4)},h.prototype.readFloatBE=function(a,b){return a>>>=0,b||H(a,4,this.length),e.read(this,a,!1,23,4)},h.prototype.readDoubleLE=function(a,b){return a>>>=0,b||H(a,8,this.length),e.read(this,a,!0,52,8)},h.prototype.readDoubleBE=function(a,b){return a>>>=0,b||H(a,8,this.length),e.read(this,a,!1,52,8)},h.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){var e=Math.pow(2,8*c)-1;I(this,a,b,c,e,0)}var f=1,g=0;for(this[b]=255&a;++g<c&&(f*=256);)this[b+g]=a/f&255;return b+c},h.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){var e=Math.pow(2,8*c)-1;I(this,a,b,c,e,0)}var f=c-1,g=1;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=a/g&255;return b+c},h.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,1,255,0),this[b]=255&a,b+1},h.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,65535,0),this[b]=255&a,this[b+1]=a>>>8,b+2},h.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,65535,0),this[b]=a>>>8,this[b+1]=255&a,b+2},h.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,4294967295,0),this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a,b+4},h.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,4294967295,0),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},h.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)a<0&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},h.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)a<0&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},h.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,1,127,-128),a<0&&(a=255+a+1),this[b]=255&a,b+1},h.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,32767,-32768),this[b]=255&a,this[b+1]=a>>>8,b+2},h.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,32767,-32768),this[b]=a>>>8,this[b+1]=255&a,b+2},h.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,2147483647,-2147483648),this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24,b+4},h.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},h.prototype.writeFloatLE=function(a,b,c){return K(this,a,b,!0,c)},h.prototype.writeFloatBE=function(a,b,c){return K(this,a,b,!1,c)},h.prototype.writeDoubleLE=function(a,b,c){return L(this,a,b,!0,c)},h.prototype.writeDoubleBE=function(a,b,c){return L(this,a,b,!1,c)},h.prototype.copy=function(a,b,c,d){if(!h.isBuffer(a))throw TypeError("argument should be a Buffer");if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c||0===a.length||0===this.length)return 0;if(b<0)throw RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw RangeError("Index out of range");if(d<0)throw RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e=d-c;if(this===a&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(b,c,d);else if(this===a&&c<b&&b<d)for(var f=e-1;f>=0;--f)a[f+b]=this[f+c];else Uint8Array.prototype.set.call(a,this.subarray(c,d),b);return e},h.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),void 0!==d&&"string"!=typeof d)throw TypeError("encoding must be a string");if("string"==typeof d&&!h.isEncoding(d))throw TypeError("Unknown encoding: "+d);if(1===a.length){var e,f=a.charCodeAt(0);("utf8"===d&&f<128||"latin1"===d)&&(a=f)}}else"number"==typeof a?a&=255:"boolean"==typeof a&&(a=Number(a));if(b<0||this.length<b||this.length<c)throw RangeError("Out of range index");if(c<=b)return this;if(b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0),"number"==typeof a)for(e=b;e<c;++e)this[e]=a;else{var g=h.isBuffer(a)?a:h.from(a,d),i=g.length;if(0===i)throw TypeError('The value "'+a+'" is invalid for argument "value"');for(e=0;e<c-b;++e)this[e+b]=g[e%i]}return this};var M=/[^+/0-9A-Za-z-_]/g;function N(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;++g){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319||g+1===d){(b-=3)> -1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)> -1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)> -1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else if(c<1114112){if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}else throw Error("Invalid code point")}return f}function O(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function P(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)d=(c=a.charCodeAt(g))>>8,e=c%256,f.push(e),f.push(d);return f}function Q(a){return d.toByteArray(function(a){if((a=(a=a.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;a.length%4!=0;)a+="=";return a}(a))}function R(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length)&&!(e>=a.length);++e)b[e+c]=a[e];return e}function S(a,b){return a instanceof b||null!=a&&null!=a.constructor&&null!=a.constructor.name&&a.constructor.name===b.name}var T=function(){for(var a="0123456789abcdef",b=Array(256),c=0;c<16;++c)for(var d=16*c,e=0;e<16;++e)b[d+e]=a[c]+a[e];return b}()},543:function(a,b){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ b.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<< -k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<< -k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},b.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?5960464477539062e-23:0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(isNaN(b=Math.abs(b))||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),g+l>=1?b+=m/i:b+=m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}}},c={};function d(a){var e=c[a];if(void 0!==e)return e.exports;var f=c[a]={exports:{}},g=!0;try{b[a](f,f.exports,d),g=!1}finally{g&&delete c[a]}return f.exports}d.ab="//";var e=d(877);a.exports=e}()},134:function(a,b,c){var d=c(5389).MY,e=c(5389).cx;function f(a){this.index=0,this.dataBuffer=a,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function g(){this.bufferBuilder=new d}function h(a){var b=a.charCodeAt(0);return b<=2047?"00":b<=65535?"000":b<=2097151?"0000":b<=67108863?"00000":"000000"}a.exports={unpack:function(a){return new f(a).unpack()},pack:function(a){var b=new g;return b.pack(a),b.getBuffer()}},f.prototype.unpack=function(){var a,b=this.unpack_uint8();if(b<128)return b;if((224^b)<32)return(224^b)-32;if((a=160^b)<=15)return this.unpack_raw(a);if((a=176^b)<=15)return this.unpack_string(a);if((a=144^b)<=15)return this.unpack_array(a);if((a=128^b)<=15)return this.unpack_map(a);switch(b){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return a=this.unpack_uint16(),this.unpack_string(a);case 217:return a=this.unpack_uint32(),this.unpack_string(a);case 218:return a=this.unpack_uint16(),this.unpack_raw(a);case 219:return a=this.unpack_uint32(),this.unpack_raw(a);case 220:return a=this.unpack_uint16(),this.unpack_array(a);case 221:return a=this.unpack_uint32(),this.unpack_array(a);case 222:return a=this.unpack_uint16(),this.unpack_map(a);case 223:return a=this.unpack_uint32(),this.unpack_map(a)}},f.prototype.unpack_uint8=function(){var a=255&this.dataView[this.index];return this.index++,a},f.prototype.unpack_uint16=function(){var a=this.read(2),b=(255&a[0])*256+(255&a[1]);return this.index+=2,b},f.prototype.unpack_uint32=function(){var a=this.read(4),b=((256*a[0]+a[1])*256+a[2])*256+a[3];return this.index+=4,b},f.prototype.unpack_uint64=function(){var a=this.read(8),b=((((((256*a[0]+a[1])*256+a[2])*256+a[3])*256+a[4])*256+a[5])*256+a[6])*256+a[7];return this.index+=8,b},f.prototype.unpack_int8=function(){var a=this.unpack_uint8();return a<128?a:a-256},f.prototype.unpack_int16=function(){var a=this.unpack_uint16();return a<32768?a:a-65536},f.prototype.unpack_int32=function(){var a=this.unpack_uint32();return a<2147483648?a:a-4294967296},f.prototype.unpack_int64=function(){var a=this.unpack_uint64();return a<0x7fffffffffffffff?a:a-18446744073709552e3},f.prototype.unpack_raw=function(a){if(this.length<this.index+a)throw Error("BinaryPackFailure: index is out of range "+this.index+" "+a+" "+this.length);var b=this.dataBuffer.slice(this.index,this.index+a);return this.index+=a,b},f.prototype.unpack_string=function(a){for(var b,c,d=this.read(a),e=0,f="";e<a;)(b=d[e])<128?(f+=String.fromCharCode(b),e++):(192^b)<32?(f+=String.fromCharCode((192^b)<<6|63&d[e+1]),e+=2):(f+=String.fromCharCode((15&b)<<12|(63&d[e+1])<<6|63&d[e+2]),e+=3);return this.index+=a,f},f.prototype.unpack_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=this.unpack();return b},f.prototype.unpack_map=function(a){for(var b={},c=0;c<a;c++){var d=this.unpack(),e=this.unpack();b[d]=e}return b},f.prototype.unpack_float=function(){var a=this.unpack_uint32();return(0==a>>31?1:-1)*(8388607&a|8388608)*Math.pow(2,(a>>23&255)-127-23)},f.prototype.unpack_double=function(){var a=this.unpack_uint32(),b=this.unpack_uint32(),c=(a>>20&2047)-1023;return(0==a>>31?1:-1)*((1048575&a|1048576)*Math.pow(2,c-20)+b*Math.pow(2,c-52))},f.prototype.read=function(a){var b=this.index;if(b+a<=this.length)return this.dataView.subarray(b,b+a);throw Error("BinaryPackFailure: read index out of range")},g.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},g.prototype.pack=function(a){var b=typeof a;if("string"===b)this.pack_string(a);else if("number"===b)Math.floor(a)===a?this.pack_integer(a):this.pack_double(a);else if("boolean"===b)!0===a?this.bufferBuilder.append(195):!1===a&&this.bufferBuilder.append(194);else if("undefined"===b)this.bufferBuilder.append(192);else if("object"===b){if(null===a)this.bufferBuilder.append(192);else{var c=a.constructor;if(c==Array)this.pack_array(a);else if(c==Blob||c==File||a instanceof Blob||a instanceof File)this.pack_bin(a);else if(c==ArrayBuffer)e.useArrayBufferView?this.pack_bin(new Uint8Array(a)):this.pack_bin(a);else if("BYTES_PER_ELEMENT"in a)e.useArrayBufferView?this.pack_bin(new Uint8Array(a.buffer)):this.pack_bin(a.buffer);else if(c==Object||c.toString().startsWith("class"))this.pack_object(a);else if(c==Date)this.pack_string(a.toString());else if("function"==typeof a.toBinaryPack)this.bufferBuilder.append(a.toBinaryPack());else throw Error('Type "'+c.toString()+'" not yet supported')}}else throw Error('Type "'+b+'" not yet supported');this.bufferBuilder.flush()},g.prototype.pack_bin=function(a){var b=a.length||a.byteLength||a.size;if(b<=15)this.pack_uint8(160+b);else if(b<=65535)this.bufferBuilder.append(218),this.pack_uint16(b);else if(b<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(b);else throw Error("Invalid length");this.bufferBuilder.append(a)},g.prototype.pack_string=function(a){var b,c=(b=a,b.length>600?new Blob([b]).size:b.replace(/[^\u0000-\u007F]/g,h).length);if(c<=15)this.pack_uint8(176+c);else if(c<=65535)this.bufferBuilder.append(216),this.pack_uint16(c);else if(c<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(c);else throw Error("Invalid length");this.bufferBuilder.append(a)},g.prototype.pack_array=function(a){var b=a.length;if(b<=15)this.pack_uint8(144+b);else if(b<=65535)this.bufferBuilder.append(220),this.pack_uint16(b);else if(b<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(b);else throw Error("Invalid length");for(var c=0;c<b;c++)this.pack(a[c])},g.prototype.pack_integer=function(a){if(a>= -32&&a<=127)this.bufferBuilder.append(255&a);else if(a>=0&&a<=255)this.bufferBuilder.append(204),this.pack_uint8(a);else if(a>= -128&&a<=127)this.bufferBuilder.append(208),this.pack_int8(a);else if(a>=0&&a<=65535)this.bufferBuilder.append(205),this.pack_uint16(a);else if(a>= -32768&&a<=32767)this.bufferBuilder.append(209),this.pack_int16(a);else if(a>=0&&a<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(a);else if(a>= -2147483648&&a<=2147483647)this.bufferBuilder.append(210),this.pack_int32(a);else if(a>= 0x8000000000000000&&a<=0x7fffffffffffffff)this.bufferBuilder.append(211),this.pack_int64(a);else if(a>=0&&a<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(a);else throw Error("Invalid integer")},g.prototype.pack_double=function(a){var b=0;a<0&&(b=1,a=-a);var c=Math.floor(Math.log(a)/Math.LN2),d=a/Math.pow(2,c)-1,e=Math.floor(4503599627370496*d),f=b<<31|c+1023<<20|e/4294967296&1048575;this.bufferBuilder.append(203),this.pack_int32(f),this.pack_int32(e%4294967296)},g.prototype.pack_object=function(a){var b=Object.keys(a).length;if(b<=15)this.pack_uint8(128+b);else if(b<=65535)this.bufferBuilder.append(222),this.pack_uint16(b);else if(b<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(b);else throw Error("Invalid length");for(var c in a)a.hasOwnProperty(c)&&(this.pack(c),this.pack(a[c]))},g.prototype.pack_uint8=function(a){this.bufferBuilder.append(a)},g.prototype.pack_uint16=function(a){this.bufferBuilder.append(a>>8),this.bufferBuilder.append(255&a)},g.prototype.pack_uint32=function(a){var b=4294967295&a;this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b)},g.prototype.pack_uint64=function(a){var b=a/4294967296,c=a%4294967296;this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b),this.bufferBuilder.append((4278190080&c)>>>24),this.bufferBuilder.append((16711680&c)>>>16),this.bufferBuilder.append((65280&c)>>>8),this.bufferBuilder.append(255&c)},g.prototype.pack_int8=function(a){this.bufferBuilder.append(255&a)},g.prototype.pack_int16=function(a){this.bufferBuilder.append((65280&a)>>8),this.bufferBuilder.append(255&a)},g.prototype.pack_int32=function(a){this.bufferBuilder.append(a>>>24&255),this.bufferBuilder.append((16711680&a)>>>16),this.bufferBuilder.append((65280&a)>>>8),this.bufferBuilder.append(255&a)},g.prototype.pack_int64=function(a){var b=Math.floor(a/4294967296),c=a%4294967296;this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b),this.bufferBuilder.append((4278190080&c)>>>24),this.bufferBuilder.append((16711680&c)>>>16),this.bufferBuilder.append((65280&c)>>>8),this.bufferBuilder.append(255&c)}},5389:function(a){var b={};b.useBlobBuilder=function(){try{return new Blob([]),!1}catch(a){return!0}}(),b.useArrayBufferView=!b.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(a){return!0}}(),a.exports.cx=b;var c=a.exports.xE;function d(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(c=a.exports.xE=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),d.prototype.append=function(a){"number"==typeof a?this._pieces.push(a):(this.flush(),this._parts.push(a))},d.prototype.flush=function(){if(this._pieces.length>0){var a=new Uint8Array(this._pieces);b.useArrayBufferView||(a=a.buffer),this._parts.push(a),this._pieces=[]}},d.prototype.getBuffer=function(){if(this.flush(),!b.useBlobBuilder)return new Blob(this._parts);for(var a=new c,d=0,e=this._parts.length;d<e;d++)a.append(this._parts[d]);return a.getBlob()},a.exports.MY=d},7461:function(a,b,c){"use strict";var d=c(4435);function e(a,b,c,e,f){var g=d.writeRtpDescription(a.kind,b);if(g+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),g+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":f||"active"),g+="a=mid:"+a.mid+"\r\n",a.rtpSender&&a.rtpReceiver?g+="a=sendrecv\r\n":a.rtpSender?g+="a=sendonly\r\n":a.rtpReceiver?g+="a=recvonly\r\n":g+="a=inactive\r\n",a.rtpSender){var h=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=h;var i="msid:"+(e?e.id:"-")+" "+h+"\r\n";g+="a="+i,g+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+i,a.sendEncodingParameters[0].rtx&&(g+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+i,g+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return g+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(g+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),g}function f(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]},d=function(a,b){a=parseInt(a,10);for(var c=0;c<b.length;c++)if(b[c].payloadType===a||b[c].preferredPayloadType===a)return b[c]},e=function(a,b,c,e){var f=d(a.parameters.apt,c),g=d(b.parameters.apt,e);return f&&g&&f.name.toLowerCase()===g.name.toLowerCase()};return a.codecs.forEach(function(d){for(var f=0;f<b.codecs.length;f++){var g=b.codecs[f];if(d.name.toLowerCase()===g.name.toLowerCase()&&d.clockRate===g.clockRate){if("rtx"===d.name.toLowerCase()&&d.parameters&&g.parameters.apt&&!e(d,g,a.codecs,b.codecs))continue;(g=JSON.parse(JSON.stringify(g))).numChannels=Math.min(d.numChannels,g.numChannels),c.codecs.push(g),g.rtcpFeedback=g.rtcpFeedback.filter(function(a){for(var b=0;b<d.rtcpFeedback.length;b++)if(d.rtcpFeedback[b].type===a.type&&d.rtcpFeedback[b].parameter===a.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c}function g(a,b,c){return -1!==({offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}})[b][a].indexOf(c)}function h(a,b){var c=a.getRemoteCandidates().find(function(a){return b.foundation===a.foundation&&b.ip===a.ip&&b.port===a.port&&b.priority===a.priority&&b.protocol===a.protocol&&b.type===a.type});return c||a.addRemoteCandidate(b),!c}function i(a,b){var c=Error(b);return c.name=a,c.code=({NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0})[a],c}a.exports=function(a,b){function c(b,c){c.addTrack(b),c.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:b}))}function j(b,c,d,e){var f=new Event("track");f.track=c,f.receiver=d,f.transceiver={receiver:d},f.streams=e,a.setTimeout(function(){b._dispatchEvent("track",f)})}var k=function(c){var e,f,g,h=this,j=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){h[a]=j[a].bind(j)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle="max-bundle"===c.bundlePolicy,"negotiate"===c.rtcpMuxPolicy)throw i("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all"}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced"}if(c.iceServers=(e=c.iceServers||[],f=b,g=!1,(e=JSON.parse(JSON.stringify(e))).filter(function(a){if(a&&(a.urls||a.url)){var b=a.urls||a.url;a.url&&!a.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var c="string"==typeof b;return c&&(b=[b]),b=b.filter(function(a){return 0!==a.indexOf("turn:")|| -1===a.indexOf("transport=udp")|| -1!==a.indexOf("turn:[")||g?0===a.indexOf("stun:")&&f>=14393&& -1===a.indexOf("?transport=udp"):(g=!0,!0)}),delete a.url,a.urls=c?b[0]:b,!!b.length}})),this._iceGatherers=[],c.iceCandidatePoolSize)for(var k=c.iceCandidatePoolSize;k>0;k--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=d.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(k.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(k.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),k.prototype.onicecandidate=null,k.prototype.onaddstream=null,k.prototype.ontrack=null,k.prototype.onremovestream=null,k.prototype.onsignalingstatechange=null,k.prototype.oniceconnectionstatechange=null,k.prototype.onconnectionstatechange=null,k.prototype.onicegatheringstatechange=null,k.prototype.onnegotiationneeded=null,k.prototype.ondatachannel=null,k.prototype._dispatchEvent=function(a,b){!this._isClosed&&(this.dispatchEvent(b),"function"==typeof this["on"+a]&&this["on"+a](b))},k.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},k.prototype.getConfiguration=function(){return this._config},k.prototype.getLocalStreams=function(){return this.localStreams},k.prototype.getRemoteStreams=function(){return this.remoteStreams},k.prototype._createTransceiver=function(a,b){var c=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&c)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();d.iceTransport=e.iceTransport,d.dtlsTransport=e.dtlsTransport}return b||this.transceivers.push(d),d},k.prototype.addTrack=function(b,c){if(this._isClosed)throw i("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(a){return a.track===b}))throw i("InvalidAccessError","Track already exists.");for(var d,e=0;e<this.transceivers.length;e++)this.transceivers[e].track||this.transceivers[e].kind!==b.kind||(d=this.transceivers[e]);return d||(d=this._createTransceiver(b.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(c)&&this.localStreams.push(c),d.track=b,d.stream=c,d.rtpSender=new a.RTCRtpSender(b,d.dtlsTransport),d.rtpSender},k.prototype.addStream=function(a){var c=this;if(b>=15025)a.getTracks().forEach(function(b){c.addTrack(b,a)});else{var d=a.clone();a.getTracks().forEach(function(a,b){var c=d.getTracks()[b];a.addEventListener("enabled",function(a){c.enabled=a.enabled})}),d.getTracks().forEach(function(a){c.addTrack(a,d)})}},k.prototype.removeTrack=function(b){if(this._isClosed)throw i("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(b instanceof a.RTCRtpSender))throw TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(a){return a.rtpSender===b});if(!c)throw i("InvalidAccessError","Sender was not created by this connection.");var d=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null,-1===this.transceivers.map(function(a){return a.stream}).indexOf(d)&&this.localStreams.indexOf(d)> -1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},k.prototype.removeStream=function(a){var b=this;a.getTracks().forEach(function(a){var c=b.getSenders().find(function(b){return b.track===a});c&&b.removeTrack(c)})},k.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},k.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},k.prototype._createIceGatherer=function(b,c){var d=this;if(c&&b>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var e=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(e,"state",{value:"new",writable:!0}),this.transceivers[b].bufferedCandidateEvents=[],this.transceivers[b].bufferCandidates=function(a){var c=!a.candidate||0===Object.keys(a.candidate).length;e.state=c?"completed":"gathering",null!==d.transceivers[b].bufferedCandidateEvents&&d.transceivers[b].bufferedCandidateEvents.push(a)},e.addEventListener("localcandidate",this.transceivers[b].bufferCandidates),e},k.prototype._gather=function(b,c){var e=this,f=this.transceivers[c].iceGatherer;if(!f.onlocalcandidate){var g=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),f.onlocalcandidate=function(a){if(!e.usingBundle||!(c>0)){var g=new Event("icecandidate");g.candidate={sdpMid:b,sdpMLineIndex:c};var h=a.candidate,i=!h||0===Object.keys(h).length;if(i)("new"===f.state||"gathering"===f.state)&&(f.state="completed");else{"new"===f.state&&(f.state="gathering"),h.component=1,h.ufrag=f.getLocalParameters().usernameFragment;var j=d.writeCandidate(h);g.candidate=Object.assign(g.candidate,d.parseCandidate(j)),g.candidate.candidate=j,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var k=d.getMediaSections(e._localDescription.sdp);i?k[g.candidate.sdpMLineIndex]+="a=end-of-candidates\r\n":k[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+"\r\n",e._localDescription.sdp=d.getDescription(e._localDescription.sdp)+k.join("");var l=e.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});"gathering"!==e.iceGatheringState&&(e.iceGatheringState="gathering",e._emitGatheringStateChange()),i||e._dispatchEvent("icecandidate",g),l&&(e._dispatchEvent("icecandidate",new Event("icecandidate")),e.iceGatheringState="complete",e._emitGatheringStateChange())}},a.setTimeout(function(){g.forEach(function(a){f.onlocalcandidate(a)})},0)}},k.prototype._createIceAndDtlsTransports=function(){var b=this,c=new a.RTCIceTransport(null);c.onicestatechange=function(){b._updateIceConnectionState(),b._updateConnectionState()};var d=new a.RTCDtlsTransport(c);return d.ondtlsstatechange=function(){b._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),b._updateConnectionState()},{iceTransport:c,dtlsTransport:d}},k.prototype._disposeIceAndDtlsTransports=function(a){var b=this.transceivers[a].iceGatherer;b&&(delete b.onlocalcandidate,delete this.transceivers[a].iceGatherer);var c=this.transceivers[a].iceTransport;c&&(delete c.onicestatechange,delete this.transceivers[a].iceTransport);var d=this.transceivers[a].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[a].dtlsTransport)},k.prototype._transceive=function(a,c,e){var g=f(a.localCapabilities,a.remoteCapabilities);c&&a.rtpSender&&(g.encodings=a.sendEncodingParameters,g.rtcp={cname:d.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(g.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(g)),e&&a.rtpReceiver&&g.codecs.length>0&&("video"===a.kind&&a.recvEncodingParameters&&b<15019&&a.recvEncodingParameters.forEach(function(a){delete a.rtx}),a.recvEncodingParameters.length?g.encodings=a.recvEncodingParameters:g.encodings=[{}],g.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(g.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(g.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(g))},k.prototype.setLocalDescription=function(a){var b,c,e=this;if(-1===["offer","answer"].indexOf(a.type))return Promise.reject(i("TypeError",'Unsupported type "'+a.type+'"'));if(!g("setLocalDescription",a.type,e.signalingState)||e._isClosed)return Promise.reject(i("InvalidStateError","Can not set local "+a.type+" in state "+e.signalingState));if("offer"===a.type)c=(b=d.splitSections(a.sdp)).shift(),b.forEach(function(a,b){var c=d.parseRtpParameters(a);e.transceivers[b].localCapabilities=c}),e.transceivers.forEach(function(a,b){e._gather(a.mid,b)});else if("answer"===a.type){c=(b=d.splitSections(e._remoteDescription.sdp)).shift();var h=d.matchPrefix(c,"a=ice-lite").length>0;b.forEach(function(a,b){var g=e.transceivers[b],i=g.iceGatherer,j=g.iceTransport,k=g.dtlsTransport,l=g.localCapabilities,m=g.remoteCapabilities,n=d.isRejected(a)&&0===d.matchPrefix(a,"a=bundle-only").length;if(!n&&!g.rejected){var o=d.getIceParameters(a,c),p=d.getDtlsParameters(a,c);h&&(p.role="server"),e.usingBundle&&0!==b||(e._gather(g.mid,b),"new"===j.state&&j.start(i,o,h?"controlling":"controlled"),"new"===k.state&&k.start(p));var q=f(l,m);e._transceive(g,q.codecs.length>0,!1)}})}return e._localDescription={type:a.type,sdp:a.sdp},"offer"===a.type?e._updateSignalingState("have-local-offer"):e._updateSignalingState("stable"),Promise.resolve()},k.prototype.setRemoteDescription=function(e){var k=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(i("TypeError",'Unsupported type "'+e.type+'"'));if(!g("setRemoteDescription",e.type,k.signalingState)||k._isClosed)return Promise.reject(i("InvalidStateError","Can not set remote "+e.type+" in state "+k.signalingState));var l={};k.remoteStreams.forEach(function(a){l[a.id]=a});var m=[],n=d.splitSections(e.sdp),o=n.shift(),p=d.matchPrefix(o,"a=ice-lite").length>0,q=d.matchPrefix(o,"a=group:BUNDLE ").length>0;k.usingBundle=q;var r=d.matchPrefix(o,"a=ice-options:")[0];return r?k.canTrickleIceCandidates=r.substr(14).split(" ").indexOf("trickle")>=0:k.canTrickleIceCandidates=!1,n.forEach(function(g,i){var j=d.splitLines(g),n=d.getKind(g),r=d.isRejected(g)&&0===d.matchPrefix(g,"a=bundle-only").length,s=j[0].substr(2).split(" ")[2],t=d.getDirection(g,o),u=d.parseMsid(g),v=d.getMid(g)||d.generateIdentifier();if(r||"application"===n&&("DTLS/SCTP"===s||"UDP/DTLS/SCTP"===s)){k.transceivers[i]={mid:v,kind:n,protocol:s,rejected:!0};return}!r&&k.transceivers[i]&&k.transceivers[i].rejected&&(k.transceivers[i]=k._createTransceiver(n,!0));var w=d.parseRtpParameters(g);r||(L=d.getIceParameters(g,o),M=d.getDtlsParameters(g,o),M.role="client"),I=d.parseRtpEncodingParameters(g);var x=d.parseRtcpParameters(g),y=d.matchPrefix(g,"a=end-of-candidates",o).length>0,z=d.matchPrefix(g,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return 1===a.component});if(("offer"===e.type||"answer"===e.type)&&!r&&q&&i>0&&k.transceivers[i]&&(k._disposeIceAndDtlsTransports(i),k.transceivers[i].iceGatherer=k.transceivers[0].iceGatherer,k.transceivers[i].iceTransport=k.transceivers[0].iceTransport,k.transceivers[i].dtlsTransport=k.transceivers[0].dtlsTransport,k.transceivers[i].rtpSender&&k.transceivers[i].rtpSender.setTransport(k.transceivers[0].dtlsTransport),k.transceivers[i].rtpReceiver&&k.transceivers[i].rtpReceiver.setTransport(k.transceivers[0].dtlsTransport)),"offer"!==e.type||r){if("answer"===e.type&&!r){D=(C=k.transceivers[i]).iceGatherer,E=C.iceTransport,F=C.dtlsTransport,G=C.rtpReceiver,H=C.sendEncodingParameters,J=C.localCapabilities,k.transceivers[i].recvEncodingParameters=I,k.transceivers[i].remoteCapabilities=w,k.transceivers[i].rtcpParameters=x,z.length&&"new"===E.state&&((p||y)&&(!q||0===i)?E.setRemoteCandidates(z):z.forEach(function(a){h(C.iceTransport,a)})),q&&0!==i||("new"===E.state&&E.start(D,L,"controlling"),"new"===F.state&&F.start(M)),!f(C.localCapabilities,C.remoteCapabilities).codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,k._transceive(C,"sendrecv"===t||"recvonly"===t,"sendrecv"===t||"sendonly"===t),G&&("sendrecv"===t||"sendonly"===t)?(K=G.track,u?(l[u.stream]||(l[u.stream]=new a.MediaStream),c(K,l[u.stream]),m.push([K,G,l[u.stream]])):(l.default||(l.default=new a.MediaStream),c(K,l.default),m.push([K,G,l.default]))):delete C.rtpReceiver}}else{(C=k.transceivers[i]||k._createTransceiver(n)).mid=v,C.iceGatherer||(C.iceGatherer=k._createIceGatherer(i,q)),z.length&&"new"===C.iceTransport.state&&(y&&(!q||0===i)?C.iceTransport.setRemoteCandidates(z):z.forEach(function(a){h(C.iceTransport,a)})),J=a.RTCRtpReceiver.getCapabilities(n),b<15019&&(J.codecs=J.codecs.filter(function(a){return"rtx"!==a.name})),H=C.sendEncodingParameters||[{ssrc:(2*i+2)*1001}];var A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=!1;"sendrecv"===t||"sendonly"===t?(O=!C.rtpReceiver,G=C.rtpReceiver||new a.RTCRtpReceiver(C.dtlsTransport,n),O&&(K=G.track,u&&"-"===u.stream||(u?(l[u.stream]||(l[u.stream]=new a.MediaStream,Object.defineProperty(l[u.stream],"id",{get:function(){return u.stream}})),Object.defineProperty(K,"id",{get:function(){return u.track}}),N=l[u.stream]):(l.default||(l.default=new a.MediaStream),N=l.default)),N&&(c(K,N),C.associatedRemoteMediaStreams.push(N)),m.push([K,G,N]))):C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(b){var c,d,e=b.getTracks().find(function(a){return a.id===C.rtpReceiver.track.id});e&&(c=e,(d=b).removeTrack(c),d.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:c})))}),C.associatedRemoteMediaStreams=[]),C.localCapabilities=J,C.remoteCapabilities=w,C.rtpReceiver=G,C.rtcpParameters=x,C.sendEncodingParameters=H,C.recvEncodingParameters=I,k._transceive(k.transceivers[i],!1,O)}}),void 0===k._dtlsRole&&(k._dtlsRole="offer"===e.type?"active":"passive"),k._remoteDescription={type:e.type,sdp:e.sdp},"offer"===e.type?k._updateSignalingState("have-remote-offer"):k._updateSignalingState("stable"),Object.keys(l).forEach(function(b){var c=l[b];if(c.getTracks().length){if(-1===k.remoteStreams.indexOf(c)){k.remoteStreams.push(c);var d=new Event("addstream");d.stream=c,a.setTimeout(function(){k._dispatchEvent("addstream",d)})}m.forEach(function(a){var b=a[0],d=a[1];c.id===a[2].id&&j(k,b,d,[c])})}}),m.forEach(function(a){!a[2]&&j(k,a[0],a[1],[])}),a.setTimeout(function(){k&&k.transceivers&&k.transceivers.forEach(function(a){a.iceTransport&&"new"===a.iceTransport.state&&a.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),a.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},k.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},k.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",b)},k.prototype._maybeFireNegotiationNeeded=function(){var b=this;"stable"===this.signalingState&& !0!==this.needNegotiation&&(this.needNegotiation=!0,a.setTimeout(function(){if(b.needNegotiation){b.needNegotiation=!1;var a=new Event("negotiationneeded");b._dispatchEvent("negotiationneeded",a)}},0))},k.prototype._updateIceConnectionState=function(){var a,b={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&b[a.iceTransport.state]++}),a="new",b.failed>0?a="failed":b.checking>0?a="checking":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0?a="connected":b.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var c=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",c)}},k.prototype._updateConnectionState=function(){var a,b={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(b[a.iceTransport.state]++,b[a.dtlsTransport.state]++)}),b.connected+=b.completed,a="new",b.failed>0?a="failed":b.connecting>0?a="connecting":b.disconnected>0?a="disconnected":b.new>0?a="new":b.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var c=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",c)}},k.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createOffer after close"));var f=c.transceivers.filter(function(a){return"audio"===a.kind}).length,g=c.transceivers.filter(function(a){return"video"===a.kind}).length,h=arguments[0];if(h){if(h.mandatory||h.optional)throw TypeError("Legacy mandatory/optional constraints not supported.");void 0!==h.offerToReceiveAudio&&(f=!0===h.offerToReceiveAudio?1:!1===h.offerToReceiveAudio?0:h.offerToReceiveAudio),void 0!==h.offerToReceiveVideo&&(g=!0===h.offerToReceiveVideo?1:!1===h.offerToReceiveVideo?0:h.offerToReceiveVideo)}for(c.transceivers.forEach(function(a){"audio"===a.kind?--f<0&&(a.wantReceive=!1):"video"===a.kind&& --g<0&&(a.wantReceive=!1)});f>0||g>0;)f>0&&(c._createTransceiver("audio"),f--),g>0&&(c._createTransceiver("video"),g--);var j=d.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);return c.transceivers.forEach(function(e,f){var g=e.track,h=e.kind,i=e.mid||d.generateIdentifier();e.mid=i,e.iceGatherer||(e.iceGatherer=c._createIceGatherer(f,c.usingBundle));var j=a.RTCRtpSender.getCapabilities(h);b<15019&&(j.codecs=j.codecs.filter(function(a){return"rtx"!==a.name})),j.codecs.forEach(function(a){"H264"===a.name&& void 0===a.parameters["level-asymmetry-allowed"]&&(a.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(b){a.name.toLowerCase()===b.name.toLowerCase()&&a.clockRate===b.clockRate&&(a.preferredPayloadType=b.payloadType)})}),j.headerExtensions.forEach(function(a){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(b){a.uri===b.uri&&(a.id=b.id)})});var k=e.sendEncodingParameters||[{ssrc:(2*f+1)*1001}];g&&b>=15019&&"video"===h&&!k[0].rtx&&(k[0].rtx={ssrc:k[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new a.RTCRtpReceiver(e.dtlsTransport,h)),e.localCapabilities=j,e.sendEncodingParameters=k}),"max-compat"!==c._config.bundlePolicy&&(j+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),j+="a=ice-options:trickle\r\n",c.transceivers.forEach(function(a,b){j+=e(a,a.localCapabilities,"offer",a.stream,c._dtlsRole),j+="a=rtcp-rsize\r\n",a.iceGatherer&&"new"!==c.iceGatheringState&&(0===b||!c.usingBundle)&&(a.iceGatherer.getLocalCandidates().forEach(function(a){a.component=1,j+="a="+d.writeCandidate(a)+"\r\n"}),"completed"===a.iceGatherer.state&&(j+="a=end-of-candidates\r\n"))}),Promise.resolve(new a.RTCSessionDescription({type:"offer",sdp:j}))},k.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(i("InvalidStateError","Can not call createAnswer after close"));if(!("have-remote-offer"===c.signalingState||"have-local-pranswer"===c.signalingState))return Promise.reject(i("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var g=d.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(g+="a=group:BUNDLE "+c.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),g+="a=ice-options:trickle\r\n";var h=d.getMediaSections(c._remoteDescription.sdp).length;return c.transceivers.forEach(function(a,d){if(!(d+1>h)){if(a.rejected){"application"===a.kind?"DTLS/SCTP"===a.protocol?g+="m=application 0 DTLS/SCTP 5000\r\n":g+="m=application 0 "+a.protocol+" webrtc-datachannel\r\n":"audio"===a.kind?g+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===a.kind&&(g+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),g+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+a.mid+"\r\n";return}a.stream&&("audio"===a.kind?i=a.stream.getAudioTracks()[0]:"video"===a.kind&&(i=a.stream.getVideoTracks()[0]),i&&b>=15019&&"video"===a.kind&&!a.sendEncodingParameters[0].rtx&&(a.sendEncodingParameters[0].rtx={ssrc:a.sendEncodingParameters[0].ssrc+1}));var i,j=f(a.localCapabilities,a.remoteCapabilities);!j.codecs.filter(function(a){return"rtx"===a.name.toLowerCase()}).length&&a.sendEncodingParameters[0].rtx&&delete a.sendEncodingParameters[0].rtx,g+=e(a,j,"answer",a.stream,c._dtlsRole),a.rtcpParameters&&a.rtcpParameters.reducedSize&&(g+="a=rtcp-rsize\r\n")}}),Promise.resolve(new a.RTCSessionDescription({type:"answer",sdp:g}))},k.prototype.addIceCandidate=function(a){var b,c=this;return a&&!(void 0!==a.sdpMLineIndex||a.sdpMid)?Promise.reject(TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,f){if(!c._remoteDescription)return f(i("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var g=a.sdpMLineIndex;if(a.sdpMid){for(var j=0;j<c.transceivers.length;j++)if(c.transceivers[j].mid===a.sdpMid){g=j;break}}var k=c.transceivers[g];if(!k)return f(i("OperationError","Can not add ICE candidate"));if(k.rejected)return e();var l=Object.keys(a.candidate).length>0?d.parseCandidate(a.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port)||l.component&&1!==l.component)return e();if((0===g||g>0&&k.iceTransport!==c.transceivers[0].iceTransport)&&!h(k.iceTransport,l))return f(i("OperationError","Can not add ICE candidate"));var m=a.candidate.trim();0===m.indexOf("a=")&&(m=m.substr(2)),b=d.getMediaSections(c._remoteDescription.sdp),b[g]+="a="+(l.type?m:"end-of-candidates")+"\r\n",c._remoteDescription.sdp=d.getDescription(c._remoteDescription.sdp)+b.join("")}else for(var n=0;n<c.transceivers.length&&(c.transceivers[n].rejected||(c.transceivers[n].iceTransport.addRemoteCandidate({}),b=d.getMediaSections(c._remoteDescription.sdp),b[n]+="a=end-of-candidates\r\n",c._remoteDescription.sdp=d.getDescription(c._remoteDescription.sdp)+b.join(""),!c.usingBundle));n++);e()})},k.prototype.getStats=function(b){if(b&&b instanceof a.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===b?c=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===b&&(c=a.rtpReceiver)}),!c)throw i("InvalidAccessError","Invalid selector.");return c.getStats()}var d=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){a[b]&&d.push(a[b].getStats())})}),Promise.all(d).then(function(a){var b=new Map;return a.forEach(function(a){a.forEach(function(a){b.set(a.id,a)})}),b})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(b){var c=a[b];if(c&&c.prototype&&c.prototype.getStats){var d=c.prototype.getStats;c.prototype.getStats=function(){return d.apply(this).then(function(a){var b=new Map;return Object.keys(a).forEach(function(c){var d;a[c].type=({inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"})[(d=a[c]).type]||d.type,b.set(c,a[c])}),b})}}});var l=["createOffer","createAnswer"];return l.forEach(function(a){var b=k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"==typeof a[0]||"function"==typeof a[1]?b.apply(this,[arguments[2]]).then(function(b){"function"==typeof a[0]&&a[0].apply(null,[b])},function(b){"function"==typeof a[1]&&a[1].apply(null,[b])}):b.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(a){var b=k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]||"function"==typeof a[2]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)},function(b){"function"==typeof a[2]&&a[2].apply(null,[b])}):b.apply(this,arguments)}}),["getStats"].forEach(function(a){var b=k.prototype[a];k.prototype[a]=function(){var a=arguments;return"function"==typeof a[1]?b.apply(this,arguments).then(function(){"function"==typeof a[1]&&a[1].apply(null)}):b.apply(this,arguments)}}),k}},4435:function(a){"use strict";var b={};b.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},b.localCName=b.generateIdentifier(),b.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},b.splitSections=function(a){return a.split("\nm=").map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},b.getDescription=function(a){var c=b.splitSections(a);return c&&c[0]},b.getMediaSections=function(a){var c=b.splitSections(a);return c.shift(),c},b.matchPrefix=function(a,c){return b.splitLines(a).filter(function(a){return 0===a.indexOf(c)})},b.parseCandidate=function(a){for(var b,c={foundation:(b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:parseInt(b[1],10),protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],address:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1];break;case"ufrag":c.ufrag=b[d+1],c.usernameFragment=b[d+1];break;default:c[b[d]]=b[d+1]}return c},b.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.address||a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(b.push("ufrag"),b.push(a.usernameFragment||a.ufrag)),"candidate:"+b.join(" ")},b.parseIceOptions=function(a){return a.substr(14).split(" ")},b.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.channels=3===b.length?parseInt(b[2],10):1,c.numChannels=c.channels,c},b.writeRtpMap=function(a){var b=a.payloadType;void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType);var c=a.channels||a.numChannels||1;return"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==c?"/"+c:"")+"\r\n"},b.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),direction:b[0].indexOf("/")>0?b[0].split("/")[1]:"sendrecv",uri:b[1]}},b.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&"sendrecv"!==a.direction?"/"+a.direction:"")+" "+a.uri+"\r\n"},b.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)c[(b=d[e].trim().split("="))[0].trim()]=b[1];return c},b.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){a.parameters[b]?d.push(b+"="+a.parameters[b]):d.push(b)}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},b.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},b.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},b.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d> -1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},b.parseSsrcGroup=function(a){var b=a.substr(13).split(" ");return{semantics:b.shift(),ssrcs:b.map(function(a){return parseInt(a,10)})}},b.getMid=function(a){var c=b.matchPrefix(a,"a=mid:")[0];if(c)return c.substr(6)},b.parseFingerprint=function(a){var b=a.substr(14).split(" ");return{algorithm:b[0].toLowerCase(),value:b[1]}},b.getDtlsParameters=function(a,c){return{role:"auto",fingerprints:b.matchPrefix(a+c,"a=fingerprint:").map(b.parseFingerprint)}},b.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},b.parseCryptoLine=function(a){var b=a.substr(9).split(" ");return{tag:parseInt(b[0],10),cryptoSuite:b[1],keyParams:b[2],sessionParams:b.slice(3)}},b.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+("object"==typeof a.keyParams?b.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+"\r\n"},b.parseCryptoKeyParams=function(a){if(0!==a.indexOf("inline:"))return null;var b=a.substr(7).split("|");return{keyMethod:"inline",keySalt:b[0],lifeTime:b[1],mkiValue:b[2]?b[2].split(":")[0]:void 0,mkiLength:b[2]?b[2].split(":")[1]:void 0}},b.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},b.getCryptoParameters=function(a,c){return b.matchPrefix(a+c,"a=crypto:").map(b.parseCryptoLine)},b.getIceParameters=function(a,c){var d=b.matchPrefix(a+c,"a=ice-ufrag:")[0],e=b.matchPrefix(a+c,"a=ice-pwd:")[0];return d&&e?{usernameFragment:d.substr(12),password:e.substr(10)}:null},b.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},b.parseRtpParameters=function(a){for(var c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=b.splitLines(a)[0].split(" "),e=3;e<d.length;e++){var f=d[e],g=b.matchPrefix(a,"a=rtpmap:"+f+" ")[0];if(g){var h=b.parseRtpMap(g),i=b.matchPrefix(a,"a=fmtp:"+f+" ");switch(h.parameters=i.length?b.parseFmtp(i[0]):{},h.rtcpFeedback=b.matchPrefix(a,"a=rtcp-fb:"+f+" ").map(b.parseRtcpFb),c.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(h.name.toUpperCase())}}}return b.matchPrefix(a,"a=extmap:").forEach(function(a){c.headerExtensions.push(b.parseExtmap(a))}),c},b.writeRtpDescription=function(a,c){var d="";d+="m="+a+" ",d+=c.codecs.length>0?"9":"0",d+=" UDP/TLS/RTP/SAVPF ",d+=c.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",d+="c=IN IP4 0.0.0.0\r\n",d+="a=rtcp:9 IN IP4 0.0.0.0\r\n",c.codecs.forEach(function(a){d+=b.writeRtpMap(a),d+=b.writeFmtp(a),d+=b.writeRtcpFb(a)});var e=0;return c.codecs.forEach(function(a){a.maxptime>e&&(e=a.maxptime)}),e>0&&(d+="a=maxptime:"+e+"\r\n"),d+="a=rtcp-mux\r\n",c.headerExtensions&&c.headerExtensions.forEach(function(a){d+=b.writeExtmap(a)}),d},b.parseRtpEncodingParameters=function(a){var c,d=[],e=b.parseRtpParameters(a),f=-1!==e.fecMechanisms.indexOf("RED"),g=-1!==e.fecMechanisms.indexOf("ULPFEC"),h=b.matchPrefix(a,"a=ssrc:").map(function(a){return b.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=b.matchPrefix(a,"a=ssrc-group:FID").map(function(a){return a.substr(17).split(" ").map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(c=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var b={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10)};i&&c&&(b.rtx={ssrc:c}),d.push(b),f&&((b=JSON.parse(JSON.stringify(b))).fec={ssrc:i,mechanism:g?"red+ulpfec":"red"},d.push(b))}}),0===d.length&&i&&d.push({ssrc:i});var k=b.matchPrefix(a,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?950*parseInt(k[0].substr(5),10)-16e3:void 0,d.forEach(function(a){a.maxBitrate=k})),d},b.parseRtcpParameters=function(a){var c={},d=b.matchPrefix(a,"a=ssrc:").map(function(a){return b.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];d&&(c.cname=d.value,c.ssrc=d.ssrc);var e=b.matchPrefix(a,"a=rtcp-rsize");c.reducedSize=e.length>0,c.compound=0===e.length;var f=b.matchPrefix(a,"a=rtcp-mux");return c.mux=f.length>0,c},b.parseMsid=function(a){var c,d=b.matchPrefix(a,"a=msid:");if(1===d.length)return{stream:(c=d[0].substr(7).split(" "))[0],track:c[1]};var e=b.matchPrefix(a,"a=ssrc:").map(function(a){return b.parseSsrcMedia(a)}).filter(function(a){return"msid"===a.attribute});if(e.length>0)return{stream:(c=e[0].value.split(" "))[0],track:c[1]}},b.parseSctpDescription=function(a){var c,d=b.parseMLine(a),e=b.matchPrefix(a,"a=max-message-size:");e.length>0&&(c=parseInt(e[0].substr(19),10)),isNaN(c)&&(c=65536);var f=b.matchPrefix(a,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substr(12),10),protocol:d.fmt,maxMessageSize:c};if(b.matchPrefix(a,"a=sctpmap:").length>0){var g=b.matchPrefix(a,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:c}}},b.writeSctpDescription=function(a,b){var c=[];return c="DTLS/SCTP"!==a.protocol?["m="+a.kind+" 9 "+a.protocol+" "+b.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+b.port+"\r\n"]:["m="+a.kind+" 9 "+a.protocol+" "+b.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+b.port+" "+b.protocol+" 65535\r\n"],void 0!==b.maxMessageSize&&c.push("a=max-message-size:"+b.maxMessageSize+"\r\n"),c.join("")},b.generateSessionId=function(){return Math.random().toString().substr(2,21)},b.writeSessionBoilerplate=function(a,c,d){var e;return"v=0\r\no="+(d||"thisisadapterortc")+" "+(e=a||b.generateSessionId())+" "+(void 0!==c?c:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},b.writeMediaSection=function(a,c,d,e){var f=b.writeRtpDescription(a.kind,c);if(f+=b.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=b.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===d?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",a.direction?f+="a="+a.direction+"\r\n":a.rtpSender&&a.rtpReceiver?f+="a=sendrecv\r\n":a.rtpSender?f+="a=sendonly\r\n":a.rtpReceiver?f+="a=recvonly\r\n":f+="a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g,a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+g,f+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+b.localCName+"\r\n",a.rtpSender&&a.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+b.localCName+"\r\n"),f},b.getDirection=function(a,c){for(var d=b.splitLines(a),e=0;e<d.length;e++)switch(d[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[e].substr(2)}return c?b.getDirection(c):"sendrecv"},b.getKind=function(a){return b.splitLines(a)[0].split(" ")[0].substr(2)},b.isRejected=function(a){return"0"===a.split(" ",2)[1]},b.parseMLine=function(a){var c=b.splitLines(a)[0].substr(2).split(" ");return{kind:c[0],port:parseInt(c[1],10),protocol:c[2],fmt:c.slice(3).join(" ")}},b.parseOLine=function(a){var c=b.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:c[0],sessionId:c[1],sessionVersion:parseInt(c[2],10),netType:c[3],addressType:c[4],address:c[5]}},b.isValidSDP=function(a){if("string"!=typeof a||0===a.length)return!1;for(var c=b.splitLines(a),d=0;d<c.length;d++)if(c[d].length<2||"="!==c[d].charAt(1))return!1;return!0},a.exports=b},9630:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return da}});var d,e,f,g,h,i,j,k,l,m,n,o={};c.r(o),c.d(o,{Decoder:function(){return aJ},Encoder:function(){return aI},PacketType:function(){return f},protocol:function(){return aH}});var p={};c.r(p),c.d(p,{fixNegotiationNeeded:function(){return be},shimAddTrackRemoveTrack:function(){return bc},shimAddTrackRemoveTrackWithNative:function(){return bb},shimGetDisplayMedia:function(){return a5},shimGetSendersWithDtmf:function(){return a8},shimGetStats:function(){return a9},shimGetUserMedia:function(){return a4},shimMediaStream:function(){return a6},shimOnTrack:function(){return a7},shimPeerConnection:function(){return bd},shimSenderReceiverGetStats:function(){return ba}});var q={};c.r(q),c.d(q,{shimGetDisplayMedia:function(){return bi},shimGetUserMedia:function(){return bh},shimPeerConnection:function(){return bj},shimReplaceTrack:function(){return bk}});var r={};c.r(r),c.d(r,{shimAddTransceiver:function(){return bt},shimCreateAnswer:function(){return bw},shimCreateOffer:function(){return bv},shimGetDisplayMedia:function(){return bm},shimGetParameters:function(){return bu},shimGetUserMedia:function(){return bl},shimOnTrack:function(){return bn},shimPeerConnection:function(){return bo},shimRTCDataChannel:function(){return bs},shimReceiverGetStats:function(){return bq},shimRemoveStream:function(){return br},shimSenderGetStats:function(){return bp}});var s={};c.r(s),c.d(s,{shimAudioContext:function(){return bF},shimCallbacksAPI:function(){return bz},shimConstraints:function(){return bB},shimCreateOfferLegacy:function(){return bE},shimGetUserMedia:function(){return bA},shimLocalStreamsAPI:function(){return bx},shimRTCIceServerUrls:function(){return bC},shimRemoteStreamsAPI:function(){return by},shimTrackEventTransceiver:function(){return bD}});var t={};c.r(t),c.d(t,{removeExtmapAllowMixed:function(){return bM},shimAddIceCandidateNullOrEmpty:function(){return bN},shimConnectionState:function(){return bL},shimMaxMessageSize:function(){return bJ},shimRTCIceCandidate:function(){return bI},shimSendThrowTypeError:function(){return bK}}),"undefined"!=typeof window&&(window.parcelRequire=window.parcelRequire||void 0);let u=Object.create(null);u.open="0",u.close="1",u.ping="2",u.pong="3",u.message="4",u.upgrade="5",u.noop="6";let v=Object.create(null);Object.keys(u).forEach(a=>{v[u[a]]=a});let w={type:"error",data:"parser error"},x="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),y="function"==typeof ArrayBuffer,z=a=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer instanceof ArrayBuffer,A=({type:a,data:b},c,d)=>x&&b instanceof Blob?c?d(b):B(b,d):y&&(b instanceof ArrayBuffer||z(b))?c?d(b):B(new Blob([b]),d):d(u[a]+(b||"")),B=(a,b)=>{let c=new FileReader;return c.onload=function(){let a=c.result.split(",")[1];b("b"+a)},c.readAsDataURL(a)};var C=A;let D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let F=0;F<D.length;F++)E[D.charCodeAt(F)]=F;let G=a=>{let b=.75*a.length,c=a.length,d,e=0,f,g,h,i;"="===a[a.length-1]&&(b--,"="===a[a.length-2]&&b--);let j=new ArrayBuffer(b),k=new Uint8Array(j);for(d=0;d<c;d+=4)f=E[a.charCodeAt(d)],g=E[a.charCodeAt(d+1)],h=E[a.charCodeAt(d+2)],i=E[a.charCodeAt(d+3)],k[e++]=f<<2|g>>4,k[e++]=(15&g)<<4|h>>2,k[e++]=(3&h)<<6|63&i;return j},H="function"==typeof ArrayBuffer,I=(a,b)=>{if("string"!=typeof a)return{type:"message",data:K(a,b)};let c=a.charAt(0);if("b"===c)return{type:"message",data:J(a.substring(1),b)};let d=v[c];return d?a.length>1?{type:v[c],data:a.substring(1)}:{type:v[c]}:w},J=(a,b)=>{if(!H)return{base64:!0,data:a};{let c=G(a);return K(c,b)}},K=(a,b)=>"blob"===b?a instanceof ArrayBuffer?new Blob([a]):a:a;var L=I;let M=(a,b)=>{let c=a.length,d=Array(c),e=0;a.forEach((a,f)=>{C(a,!1,a=>{d[f]=a,++e===c&&b(d.join("\x1e"))})})},N=(a,b)=>{let c=a.split("\x1e"),d=[];for(let e=0;e<c.length;e++){let f=L(c[e],b);if(d.push(f),"error"===f.type)break}return d};function O(a){if(a)return P(a)}function P(a){for(var b in O.prototype)a[b]=O.prototype[b];return a}O.prototype.on=O.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},O.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},O.prototype.off=O.prototype.removeListener=O.prototype.removeAllListeners=O.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c,d=this._callbacks["$"+a];if(!d)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var e=0;e<d.length;e++)if((c=d[e])===b||c.fn===b){d.splice(e,1);break}return 0===d.length&&delete this._callbacks["$"+a],this},O.prototype.emit=function(a){this._callbacks=this._callbacks||{};for(var b=Array(arguments.length-1),c=this._callbacks["$"+a],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},O.prototype.emitReserved=O.prototype.emit,O.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},O.prototype.hasListeners=function(a){return!!this.listeners(a).length};let Q="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function R(a,...b){return b.reduce((b,c)=>(a.hasOwnProperty(c)&&(b[c]=a[c]),b),{})}let S=setTimeout,T=clearTimeout;function U(a,b){b.useNativeTimers?(a.setTimeoutFn=S.bind(Q),a.clearTimeoutFn=T.bind(Q)):(a.setTimeoutFn=setTimeout.bind(Q),a.clearTimeoutFn=clearTimeout.bind(Q))}function V(a){return"string"==typeof a?W(a):Math.ceil(1.33*(a.byteLength||a.size))}function W(a){let b=0,c=0;for(let d=0,e=a.length;d<e;d++)(b=a.charCodeAt(d))<128?c+=1:b<2048?c+=2:b<55296||b>=57344?c+=3:(d++,c+=4);return c}class X extends Error{constructor(a,b,c){super(a),this.description=b,this.context=c,this.type="TransportError"}}class Y extends O{constructor(a){super(),this.writable=!1,U(this,a),this.opts=a,this.query=a.query,this.readyState="",this.socket=a.socket}onError(a,b,c){return super.emitReserved("error",new X(a,b,c)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(a){"open"===this.readyState&&this.write(a)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(a){let b=L(a,this.socket.binaryType);this.onPacket(b)}onPacket(a){super.emitReserved("packet",a)}onClose(a){this.readyState="closed",super.emitReserved("close",a)}}let Z="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),$={},_=0,aa=0,ab;function ac(a){let b="";do b=Z[a%64]+b,a=Math.floor(a/64);while(a>0);return b}function ad(){let a=ac(+new Date);return a!==ab?(_=0,ab=a):a+"."+ac(_++)}for(;aa<64;aa++)$[Z[aa]]=aa;function ae(a){let b="";for(let c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b}let af=!1;try{af="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(ag){}let ah=af;function ai(a){let b=a.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!b||ah))return new XMLHttpRequest}catch(c){}if(!b)try{return new Q[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(d){}}function aj(){}let ak=function(){let a=new ai({xdomain:!1});return null!=a.responseType}();class al extends O{constructor(a,b){super(),U(this,b),this.opts=b,this.method=b.method||"GET",this.uri=a,this.async=!1!==b.async,this.data=void 0!==b.data?b.data:null,this.create()}create(){let a=R(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this.opts.xd,a.xscheme=!!this.opts.xs;let b=this.xhr=new ai(a);try{b.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(let c in b.setDisableHeaderCheck&&b.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(c)&&b.setRequestHeader(c,this.opts.extraHeaders[c])}catch(d){}if("POST"===this.method)try{b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{b.setRequestHeader("Accept","*/*")}catch(f){}"withCredentials"in b&&(b.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(b.timeout=this.opts.requestTimeout),b.onreadystatechange=()=>{4===b.readyState&&(200===b.status||1223===b.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof b.status?b.status:0)},0))},b.send(this.data)}catch(g){this.setTimeoutFn(()=>{this.onError(g)},0);return}"undefined"!=typeof document&&(this.index=al.requestsCount++,al.requests[this.index]=this)}onError(a){this.emitReserved("error",a,this.xhr),this.cleanup(!0)}cleanup(a){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=aj,a)try{this.xhr.abort()}catch(b){}"undefined"!=typeof document&&delete al.requests[this.index],this.xhr=null}}onLoad(){let a=this.xhr.responseText;null!==a&&(this.emitReserved("data",a),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(al.requestsCount=0,al.requests={},"undefined"!=typeof document){if("function"==typeof attachEvent)attachEvent("onunload",an);else if("function"==typeof addEventListener){let am="onpagehide"in Q?"pagehide":"unload";addEventListener(am,an,!1)}}function an(){for(let a in al.requests)al.requests.hasOwnProperty(a)&&al.requests[a].abort()}let ao=(()=>{let a="function"==typeof Promise&&"function"==typeof Promise.resolve;return a?a=>Promise.resolve().then(a):(a,b)=>b(a,0)})(),ap=Q.WebSocket||Q.MozWebSocket;c(7820).Buffer;let aq="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),ar={websocket:class extends Y{constructor(a){super(a),this.supportsBinary=!a.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let a=this.uri(),b=this.opts.protocols,c=aq?{}:R(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(c.headers=this.opts.extraHeaders);try{this.ws=aq?new ap(a,b,c):b?new ap(a,b):new ap(a)}catch(d){return this.emitReserved("error",d)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=a=>this.onClose({description:"websocket connection closed",context:a}),this.ws.onmessage=a=>this.onData(a.data),this.ws.onerror=a=>this.onError("websocket error",a)}write(a){this.writable=!1;for(let b=0;b<a.length;b++){let c=a[b],d=b===a.length-1;C(c,this.supportsBinary,a=>{try{this.ws.send(a)}catch(b){}d&&ao(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let a=this.query||{},b=this.opts.secure?"wss":"ws",c="";this.opts.port&&("wss"===b&&443!==Number(this.opts.port)||"ws"===b&&80!==Number(this.opts.port))&&(c=":"+this.opts.port),this.opts.timestampRequests&&(a[this.opts.timestampParam]=ad()),this.supportsBinary||(a.b64=1);let d=ae(a),e=-1!==this.opts.hostname.indexOf(":");return b+"://"+(e?"["+this.opts.hostname+"]":this.opts.hostname)+c+this.opts.path+(d.length?"?"+d:"")}check(){return!!ap}},polling:class extends Y{constructor(a){if(super(a),this.polling=!1,"undefined"!=typeof location){let b="https:"===location.protocol,c=location.port;c||(c=b?"443":"80"),this.xd="undefined"!=typeof location&&a.hostname!==location.hostname||c!==a.port,this.xs=a.secure!==b}let d=a&&a.forceBase64;this.supportsBinary=ak&&!d}get name(){return"polling"}doOpen(){this.poll()}pause(a){this.readyState="pausing";let b=()=>{this.readyState="paused",a()};if(this.polling||!this.writable){let c=0;this.polling&&(c++,this.once("pollComplete",function(){--c||b()})),this.writable||(c++,this.once("drain",function(){--c||b()}))}else b()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(a){let b=a=>{if("opening"===this.readyState&&"open"===a.type&&this.onOpen(),"close"===a.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(a)};N(a,this.socket.binaryType).forEach(b),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let a=()=>{this.write([{type:"close"}])};"open"===this.readyState?a():this.once("open",a)}write(a){this.writable=!1,M(a,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let a=this.query||{},b=this.opts.secure?"https":"http",c="";!1!==this.opts.timestampRequests&&(a[this.opts.timestampParam]=ad()),this.supportsBinary||a.sid||(a.b64=1),this.opts.port&&("https"===b&&443!==Number(this.opts.port)||"http"===b&&80!==Number(this.opts.port))&&(c=":"+this.opts.port);let d=ae(a),e=-1!==this.opts.hostname.indexOf(":");return b+"://"+(e?"["+this.opts.hostname+"]":this.opts.hostname)+c+this.opts.path+(d.length?"?"+d:"")}request(a={}){return Object.assign(a,{xd:this.xd,xs:this.xs},this.opts),new al(this.uri(),a)}doWrite(a,b){let c=this.request({method:"POST",data:a});c.on("success",b),c.on("error",(a,b)=>{this.onError("xhr post error",a,b)})}doPoll(){let a=this.request();a.on("data",this.onData.bind(this)),a.on("error",(a,b)=>{this.onError("xhr poll error",a,b)}),this.pollXhr=a}}},as=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,at=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function au(a){let b=a,c=a.indexOf("["),d=a.indexOf("]");-1!=c&& -1!=d&&(a=a.substring(0,c)+a.substring(c,d).replace(/:/g,";")+a.substring(d,a.length));let e=as.exec(a||""),f={},g=14;for(;g--;)f[at[g]]=e[g]||"";return -1!=c&& -1!=d&&(f.source=b,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=av(f,f.path),f.queryKey=aw(f,f.query),f}function av(a,b){let c=b.replace(/\/{2,9}/g,"/").split("/");return("/"==b.substr(0,1)||0===b.length)&&c.splice(0,1),"/"==b.substr(b.length-1,1)&&c.splice(c.length-1,1),c}function aw(a,b){let c={};return b.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(a,b,d){b&&(c[b]=d)}),c}class ax extends O{constructor(a,b={}){super(),a&&"object"==typeof a&&(b=a,a=null),a?(a=au(a),b.hostname=a.host,b.secure="https"===a.protocol||"wss"===a.protocol,b.port=a.port,a.query&&(b.query=a.query)):b.host&&(b.hostname=au(b.host).host),U(this,b),this.secure=null!=b.secure?b.secure:"undefined"!=typeof location&&"https:"===location.protocol,b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.hostname=b.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=b.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},b),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(a){let b={},c=a.split("&");for(let d=0,e=c.length;d<e;d++){let f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(a){let b=Object.assign({},this.opts.query);b.EIO=4,b.transport=a,this.id&&(b.sid=this.id);let c=Object.assign({},this.opts.transportOptions[a],this.opts,{query:b,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new ar[a](c)}open(){let a;if(this.opts.rememberUpgrade&&ax.priorWebsocketSuccess&& -1!==this.transports.indexOf("websocket"))a="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else a=this.transports[0];this.readyState="opening";try{a=this.createTransport(a)}catch(b){this.transports.shift(),this.open();return}a.open(),this.setTransport(a)}setTransport(a){this.transport&&this.transport.removeAllListeners(),this.transport=a,a.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",a=>this.onClose("transport close",a))}probe(a){let b=this.createTransport(a),c=!1;ax.priorWebsocketSuccess=!1;let d=()=>{c||(b.send([{type:"ping",data:"probe"}]),b.once("packet",a=>{if(!c){if("pong"===a.type&&"probe"===a.data)this.upgrading=!0,this.emitReserved("upgrading",b),b&&(ax.priorWebsocketSuccess="websocket"===b.name,this.transport.pause(()=>{!c&&"closed"!==this.readyState&&(j(),this.setTransport(b),b.send([{type:"upgrade"}]),this.emitReserved("upgrade",b),b=null,this.upgrading=!1,this.flush())}));else{let d=Error("probe error");d.transport=b.name,this.emitReserved("upgradeError",d)}}}))};function e(){c||(c=!0,j(),b.close(),b=null)}let f=a=>{let c=Error("probe error: "+a);c.transport=b.name,e(),this.emitReserved("upgradeError",c)};function g(){f("transport closed")}function h(){f("socket closed")}function i(a){b&&a.name!==b.name&&e()}let j=()=>{b.removeListener("open",d),b.removeListener("error",f),b.removeListener("close",g),this.off("close",h),this.off("upgrading",i)};b.once("open",d),b.once("error",f),b.once("close",g),this.once("close",h),this.once("upgrading",i),b.open()}onOpen(){if(this.readyState="open",ax.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let a=0,b=this.upgrades.length;for(;a<b;a++)this.probe(this.upgrades[a])}}onPacket(a){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",a),this.emitReserved("heartbeat"),a.type){case"open":this.onHandshake(JSON.parse(a.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let b=Error("server error");b.code=a.data,this.onError(b);break;case"message":this.emitReserved("data",a.data),this.emitReserved("message",a.data)}}onHandshake(a){this.emitReserved("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.maxPayload=a.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let a=this.getWritablePackets();this.transport.send(a),this.prevBufferLen=a.length,this.emitReserved("flush")}}getWritablePackets(){let a=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!a)return this.writeBuffer;let b=1;for(let c=0;c<this.writeBuffer.length;c++){let d=this.writeBuffer[c].data;if(d&&(b+=V(d)),c>0&&b>this.maxPayload)return this.writeBuffer.slice(0,c);b+=2}return this.writeBuffer}write(a,b,c){return this.sendPacket("message",a,b,c),this}send(a,b,c){return this.sendPacket("message",a,b,c),this}sendPacket(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=c,c=null),"closing"===this.readyState||"closed"===this.readyState)return;(c=c||{}).compress=!1!==c.compress;let e={type:a,data:b,options:c};this.emitReserved("packetCreate",e),this.writeBuffer.push(e),d&&this.once("flush",d),this.flush()}close(){let a=()=>{this.onClose("forced close"),this.transport.close()},b=()=>{this.off("upgrade",b),this.off("upgradeError",b),a()},c=()=>{this.once("upgrade",b),this.once("upgradeError",b)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?c():a()}):this.upgrading?c():a()),this}onError(a){ax.priorWebsocketSuccess=!1,this.emitReserved("error",a),this.onClose("transport error",a)}onClose(a,b){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",a,b),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(a){let b=[],c=0,d=a.length;for(;c<d;c++)~this.transports.indexOf(a[c])&&b.push(a[c]);return b}}ax.protocol=4,ax.protocol;let ay="function"==typeof ArrayBuffer,az=a=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(a):a.buffer instanceof ArrayBuffer,aA=Object.prototype.toString,aB="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===aA.call(Blob),aC="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===aA.call(File);function aD(a){return ay&&(a instanceof ArrayBuffer||az(a))||aB&&a instanceof Blob||aC&&a instanceof File}function aE(a,b){if(!a||"object"!=typeof a)return!1;if(Array.isArray(a)){for(let c=0,d=a.length;c<d;c++)if(aE(a[c]))return!0;return!1}if(aD(a))return!0;if(a.toJSON&&"function"==typeof a.toJSON&&1===arguments.length)return aE(a.toJSON(),!0);for(let e in a)if(Object.prototype.hasOwnProperty.call(a,e)&&aE(a[e]))return!0;return!1}function aF(a,b){if(!a)return a;if(aD(a)){let c={_placeholder:!0,num:b.length};return b.push(a),c}if(Array.isArray(a)){let d=Array(a.length);for(let e=0;e<a.length;e++)d[e]=aF(a[e],b);return d}if("object"==typeof a&&!(a instanceof Date)){let f={};for(let g in a)Object.prototype.hasOwnProperty.call(a,g)&&(f[g]=aF(a[g],b));return f}return a}function aG(a,b){if(!a)return a;if(a&& !0===a._placeholder){let c="number"==typeof a.num&&a.num>=0&&a.num<b.length;if(c)return b[a.num];throw Error("illegal attachments")}if(Array.isArray(a))for(let d=0;d<a.length;d++)a[d]=aG(a[d],b);else if("object"==typeof a)for(let e in a)Object.prototype.hasOwnProperty.call(a,e)&&(a[e]=aG(a[e],b));return a}let aH=5;(bR=f||(f={}))[bR.CONNECT=0]="CONNECT",bR[bR.DISCONNECT=1]="DISCONNECT",bR[bR.EVENT=2]="EVENT",bR[bR.ACK=3]="ACK",bR[bR.CONNECT_ERROR=4]="CONNECT_ERROR",bR[bR.BINARY_EVENT=5]="BINARY_EVENT",bR[bR.BINARY_ACK=6]="BINARY_ACK";class aI{constructor(a){this.replacer=a}encode(a){return(a.type===f.EVENT||a.type===f.ACK)&&aE(a)?(a.type=a.type===f.EVENT?f.BINARY_EVENT:f.BINARY_ACK,this.encodeAsBinary(a)):[this.encodeAsString(a)]}encodeAsString(a){let b=""+a.type;return(a.type===f.BINARY_EVENT||a.type===f.BINARY_ACK)&&(b+=a.attachments+"-"),a.nsp&&"/"!==a.nsp&&(b+=a.nsp+","),null!=a.id&&(b+=a.id),null!=a.data&&(b+=JSON.stringify(a.data,this.replacer)),b}encodeAsBinary(a){let b=function(a){let b=[],c=a.data,d=a;return d.data=aF(c,b),d.attachments=b.length,{packet:d,buffers:b}}(a),c=this.encodeAsString(b.packet),d=b.buffers;return d.unshift(c),d}}class aJ extends O{constructor(a){super(),this.reviver=a}add(a){let b;if("string"==typeof a){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");(b=this.decodeString(a)).type===f.BINARY_EVENT||b.type===f.BINARY_ACK?(this.reconstructor=new aK(b),0===b.attachments&&super.emitReserved("decoded",b)):super.emitReserved("decoded",b)}else if(aD(a)||a.base64){if(this.reconstructor)(b=this.reconstructor.takeBinaryData(a))&&(this.reconstructor=null,super.emitReserved("decoded",b));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+a)}decodeString(a){let b=0,c={type:Number(a.charAt(0))};if(void 0===f[c.type])throw Error("unknown packet type "+c.type);if(c.type===f.BINARY_EVENT||c.type===f.BINARY_ACK){let d=b+1;for(;"-"!==a.charAt(++b)&&b!=a.length;);let e=a.substring(d,b);if(e!=Number(e)||"-"!==a.charAt(b))throw Error("Illegal attachments");c.attachments=Number(e)}if("/"===a.charAt(b+1)){let g=b+1;for(;++b;){let h=a.charAt(b);if(","===h||b===a.length)break}c.nsp=a.substring(g,b)}else c.nsp="/";let i=a.charAt(b+1);if(""!==i&&Number(i)==i){let j=b+1;for(;++b;){let k=a.charAt(b);if(null==k||Number(k)!=k){--b;break}if(b===a.length)break}c.id=Number(a.substring(j,b+1))}if(a.charAt(++b)){let l=this.tryParse(a.substr(b));if(aJ.isPayloadValid(c.type,l))c.data=l;else throw Error("invalid payload")}return c}tryParse(a){try{return JSON.parse(a,this.reviver)}catch(b){return!1}}static isPayloadValid(a,b){switch(a){case f.CONNECT:return"object"==typeof b;case f.DISCONNECT:return void 0===b;case f.CONNECT_ERROR:return"string"==typeof b||"object"==typeof b;case f.EVENT:case f.BINARY_EVENT:return Array.isArray(b)&&b.length>0;case f.ACK:case f.BINARY_ACK:return Array.isArray(b)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class aK{constructor(a){this.packet=a,this.buffers=[],this.reconPack=a}takeBinaryData(a){if(this.buffers.push(a),this.buffers.length===this.reconPack.attachments){var b,c;let d=(b=this.reconPack,c=this.buffers,b.data=aG(b.data,c),b.attachments=void 0,b);return this.finishedReconstruction(),d}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function aL(a,b,c){return a.on(b,c),function(){a.off(b,c)}}let aM=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class aN extends O{constructor(a,b,c){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=a,this.nsp=b,c&&c.auth&&(this.auth=c.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let a=this.io;this.subs=[aL(a,"open",this.onopen.bind(this)),aL(a,"packet",this.onpacket.bind(this)),aL(a,"error",this.onerror.bind(this)),aL(a,"close",this.onclose.bind(this)),]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io["_reconnecting"]||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...a){return a.unshift("message"),this.emit.apply(this,a),this}emit(a,...b){if(aM.hasOwnProperty(a))throw Error('"'+a+'" is a reserved event name');b.unshift(a);let c={type:f.EVENT,data:b};if(c.options={},c.options.compress=!1!==this.flags.compress,"function"==typeof b[b.length-1]){let d=this.ids++,e=b.pop();this._registerAckCallback(d,e),c.id=d}let g=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,h=this.flags.volatile&&(!g||!this.connected);return h||(this.connected?(this.notifyOutgoingListeners(c),this.packet(c)):this.sendBuffer.push(c)),this.flags={},this}_registerAckCallback(a,b){let c=this.flags.timeout;if(void 0===c){this.acks[a]=b;return}let d=this.io.setTimeoutFn(()=>{delete this.acks[a];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===a&&this.sendBuffer.splice(c,1);b.call(this,Error("operation has timed out"))},c);this.acks[a]=(...a)=>{this.io.clearTimeoutFn(d),b.apply(this,[null,...a])}}packet(a){a.nsp=this.nsp,this.io._packet(a)}onopen(){"function"==typeof this.auth?this.auth(a=>{this.packet({type:f.CONNECT,data:a})}):this.packet({type:f.CONNECT,data:this.auth})}onerror(a){this.connected||this.emitReserved("connect_error",a)}onclose(a,b){this.connected=!1,delete this.id,this.emitReserved("disconnect",a,b)}onpacket(a){let b=a.nsp===this.nsp;if(b)switch(a.type){case f.CONNECT:if(a.data&&a.data.sid){let c=a.data.sid;this.onconnect(c)}else this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case f.EVENT:case f.BINARY_EVENT:this.onevent(a);break;case f.ACK:case f.BINARY_ACK:this.onack(a);break;case f.DISCONNECT:this.ondisconnect();break;case f.CONNECT_ERROR:this.destroy();let d=Error(a.data.message);d.data=a.data.data,this.emitReserved("connect_error",d)}}onevent(a){let b=a.data||[];null!=a.id&&b.push(this.ack(a.id)),this.connected?this.emitEvent(b):this.receiveBuffer.push(Object.freeze(b))}emitEvent(a){if(this._anyListeners&&this._anyListeners.length){let b=this._anyListeners.slice();for(let c of b)c.apply(this,a)}super.emit.apply(this,a)}ack(a){let b=this,c=!1;return function(...d){c||(c=!0,b.packet({type:f.ACK,id:a,data:d}))}}onack(a){let b=this.acks[a.id];"function"==typeof b&&(b.apply(this,a.data),delete this.acks[a.id])}onconnect(a){this.id=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(a=>this.emitEvent(a)),this.receiveBuffer=[],this.sendBuffer.forEach(a=>{this.notifyOutgoingListeners(a),this.packet(a)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(a=>a()),this.subs=void 0),this.io["_destroy"](this)}disconnect(){return this.connected&&this.packet({type:f.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(a){return this.flags.compress=a,this}get volatile(){return this.flags.volatile=!0,this}timeout(a){return this.flags.timeout=a,this}onAny(a){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(a),this}prependAny(a){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(a),this}offAny(a){if(!this._anyListeners)return this;if(a){let b=this._anyListeners;for(let c=0;c<b.length;c++)if(a===b[c]){b.splice(c,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(a){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(a),this}prependAnyOutgoing(a){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(a),this}offAnyOutgoing(a){if(!this._anyOutgoingListeners)return this;if(a){let b=this._anyOutgoingListeners;for(let c=0;c<b.length;c++)if(a===b[c]){b.splice(c,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(a){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let b=this._anyOutgoingListeners.slice();for(let c of b)c.apply(this,a.data)}}}function aO(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}aO.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=(1&Math.floor(10*b))==0?a-c:a+c}return 0|Math.min(a,this.max)},aO.prototype.reset=function(){this.attempts=0},aO.prototype.setMin=function(a){this.ms=a},aO.prototype.setMax=function(a){this.max=a},aO.prototype.setJitter=function(a){this.jitter=a};class aP extends O{constructor(a,b){var c;super(),this.nsps={},this.subs=[],a&&"object"==typeof a&&(b=a,a=void 0),(b=b||{}).path=b.path||"/socket.io",this.opts=b,U(this,b),this.reconnection(!1!==b.reconnection),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(c=b.randomizationFactor)&& void 0!==c?c:.5),this.backoff=new aO({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==b.timeout?2e4:b.timeout),this._readyState="closed",this.uri=a;let d=b.parser||o;this.encoder=new d.Encoder,this.decoder=new d.Decoder,this._autoConnect=!1!==b.autoConnect,this._autoConnect&&this.open()}reconnection(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection}reconnectionAttempts(a){return void 0===a?this._reconnectionAttempts:(this._reconnectionAttempts=a,this)}reconnectionDelay(a){var b;return void 0===a?this._reconnectionDelay:(this._reconnectionDelay=a,null===(b=this.backoff)|| void 0===b||b.setMin(a),this)}randomizationFactor(a){var b;return void 0===a?this._randomizationFactor:(this._randomizationFactor=a,null===(b=this.backoff)|| void 0===b||b.setJitter(a),this)}reconnectionDelayMax(a){var b;return void 0===a?this._reconnectionDelayMax:(this._reconnectionDelayMax=a,null===(b=this.backoff)|| void 0===b||b.setMax(a),this)}timeout(a){return arguments.length?(this._timeout=a,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(a){if(~this._readyState.indexOf("open"))return this;this.engine=new ax(this.uri,this.opts);let b=this.engine,c=this;this._readyState="opening",this.skipReconnect=!1;let d=aL(b,"open",function(){c.onopen(),a&&a()}),e=aL(b,"error",b=>{c.cleanup(),c._readyState="closed",this.emitReserved("error",b),a?a(b):c.maybeReconnectOnOpen()});if(!1!==this._timeout){let f=this._timeout;0===f&&d();let g=this.setTimeoutFn(()=>{d(),b.close(),b.emit("error",Error("timeout"))},f);this.opts.autoUnref&&g.unref(),this.subs.push(function(){clearTimeout(g)})}return this.subs.push(d),this.subs.push(e),this}connect(a){return this.open(a)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let a=this.engine;this.subs.push(aL(a,"ping",this.onping.bind(this)),aL(a,"data",this.ondata.bind(this)),aL(a,"error",this.onerror.bind(this)),aL(a,"close",this.onclose.bind(this)),aL(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(a){this.decoder.add(a)}ondecoded(a){this.emitReserved("packet",a)}onerror(a){this.emitReserved("error",a)}socket(a,b){let c=this.nsps[a];return c||(c=new aN(this,a,b),this.nsps[a]=c),c}_destroy(a){let b=Object.keys(this.nsps);for(let c of b){let d=this.nsps[c];if(d.active)return}this._close()}_packet(a){let b=this.encoder.encode(a);for(let c=0;c<b.length;c++)this.engine.write(b[c],a.options)}cleanup(){this.subs.forEach(a=>a()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(a,b){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",a,b),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let a=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let b=this.backoff.duration();this._reconnecting=!0;let c=this.setTimeoutFn(()=>{!a.skipReconnect&&(this.emitReserved("reconnect_attempt",a.backoff.attempts),a.skipReconnect||a.open(b=>{b?(a._reconnecting=!1,a.reconnect(),this.emitReserved("reconnect_error",b)):a.onreconnect()}))},b);this.opts.autoUnref&&c.unref(),this.subs.push(function(){clearTimeout(c)})}}onreconnect(){let a=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",a)}}let aQ={};function aR(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};let c=function(a,b="",c){let d=a;c=c||"undefined"!=typeof location&&location,null==a&&(a=c.protocol+"//"+c.host),"string"==typeof a&&("/"===a.charAt(0)&&(a="/"===a.charAt(1)?c.protocol+a:c.host+a),/^(https?|wss?):\/\//.test(a)||(a=void 0!==c?c.protocol+"//"+a:"https://"+a),d=au(a)),!d.port&&(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";let e=-1!==d.host.indexOf(":"),f=e?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+f+":"+d.port+b,d.href=d.protocol+"://"+f+(c&&c.port===d.port?"":":"+d.port),d}(a,b.path||"/socket.io"),d=c.source,e=c.id,f=c.path,g=aQ[e]&&f in aQ[e].nsps,h=b.forceNew||b["force new connection"]|| !1===b.multiplex||g,i;return h?i=new aP(d,b):(aQ[e]||(aQ[e]=new aP(d,b)),i=aQ[e]),c.query&&!b.query&&(b.query=c.queryKey),i.socket(c.path,b)}Object.assign(aR,{Manager:aP,Socket:aN,io:aR,connect:aR});var aS=c(134);let aT=!0,aU=!0;function aV(a,b,c){let d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)}function aW(a,b,c){if(!a.RTCPeerConnection)return;let d=a.RTCPeerConnection.prototype,e=d.addEventListener;d.addEventListener=function(a,d){if(a!==b)return e.apply(this,arguments);let f=a=>{let b=c(a);b&&(d.handleEvent?d.handleEvent(b):d(b))};return this._eventMap=this._eventMap||{},this._eventMap[b]||(this._eventMap[b]=new Map),this._eventMap[b].set(d,f),e.apply(this,[a,f])};let f=d.removeEventListener;d.removeEventListener=function(a,c){if(a!==b||!this._eventMap||!this._eventMap[b]||!this._eventMap[b].has(c))return f.apply(this,arguments);let d=this._eventMap[b].get(c);return this._eventMap[b].delete(c),0===this._eventMap[b].size&&delete this._eventMap[b],0===Object.keys(this._eventMap).length&&delete this._eventMap,f.apply(this,[a,d])},Object.defineProperty(d,"on"+b,{get(){return this["_on"+b]},set(a){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),a&&this.addEventListener(b,this["_on"+b]=a)},enumerable:!0,configurable:!0})}function aX(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(aT=a,a?"adapter.js logging disabled":"adapter.js logging enabled")}function aY(a){return"boolean"!=typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(aU=!a,"adapter.js deprecation warnings "+(a?"disabled":"enabled"))}function aZ(){"object"==typeof window&& !aT&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function a$(a,b){aU&&console.warn(a+" is deprecated, please use "+b+" instead.")}function a_(a){return"[object Object]"===Object.prototype.toString.call(a)}function a0(a){return a_(a)?Object.keys(a).reduce(function(b,c){let d=a_(a[c]),e=d?a0(a[c]):a[c],f=d&&!Object.keys(e).length;return void 0===e||f?b:Object.assign(b,{[c]:e})},{}):a}function a1(a,b,c){!(!b||c.has(b.id))&&(c.set(b.id,b),Object.keys(b).forEach(d=>{d.endsWith("Id")?a1(a,a.get(b[d]),c):d.endsWith("Ids")&&b[d].forEach(b=>{a1(a,a.get(b),c)})}))}function a2(a,b,c){let d=c?"outbound-rtp":"inbound-rtp",e=new Map;if(null===b)return e;let f=[];return a.forEach(a=>{"track"===a.type&&a.trackIdentifier===b.id&&f.push(a)}),f.forEach(b=>{a.forEach(c=>{c.type===d&&c.trackId===b.id&&a1(a,c,e)})}),e}let a3=aZ;function a4(a,b){let c=a&&a.navigator;if(!c.mediaDevices)return;let d=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;let b={};return Object.keys(a).forEach(c=>{if("require"===c||"advanced"===c||"mediaSource"===c)return;let d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);let e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];let f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),(f={})[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(a=>{void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},e=function(a,e){if(b.version>=61)return e(a);if((a=JSON.parse(JSON.stringify(a)))&&"object"==typeof a.audio){let f=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])};f((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","googAutoGainControl"),f(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=d(a.audio)}if(a&&"object"==typeof a.video){let g=a.video.facingMode;g=g&&("object"==typeof g?g:{ideal:g});let h=b.version<66;if(g&&("user"===g.exact||"environment"===g.exact||"user"===g.ideal||"environment"===g.ideal)&&!(c.mediaDevices.getSupportedConstraints&&c.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let i;if("environment"===g.exact||"environment"===g.ideal?i=["back","rear"]:("user"===g.exact||"user"===g.ideal)&&(i=["front"]),i)return c.mediaDevices.enumerateDevices().then(b=>{let c=(b=b.filter(a=>"videoinput"===a.kind)).find(a=>i.some(b=>a.label.toLowerCase().includes(b)));return!c&&b.length&&i.includes("back")&&(c=b[b.length-1]),c&&(a.video.deviceId=g.exact?{exact:c.deviceId}:{ideal:c.deviceId}),a.video=d(a.video),a3("chrome: "+JSON.stringify(a)),e(a)})}a.video=d(a.video)}return a3("chrome: "+JSON.stringify(a)),e(a)},f=function(a){return b.version>=64?a:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},g=function(a,b,d){e(a,a=>{c.webkitGetUserMedia(a,b,a=>{d&&d(f(a))})})};if(c.getUserMedia=g.bind(c),c.mediaDevices.getUserMedia){let h=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(a){return e(a,a=>h(a).then(b=>{if(a.audio&&!b.getAudioTracks().length||a.video&&!b.getVideoTracks().length)throw b.getTracks().forEach(a=>{a.stop()}),new DOMException("","NotFoundError");return b},a=>Promise.reject(f(a))))}}}function a5(a,b){if((!a.navigator.mediaDevices||!("getDisplayMedia"in a.navigator.mediaDevices))&&a.navigator.mediaDevices){if("function"!=typeof b){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}a.navigator.mediaDevices.getDisplayMedia=function(c){return b(c).then(b=>{let d=c.video&&c.video.width,e=c.video&&c.video.height,f=c.video&&c.video.frameRate;return c.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:b,maxFrameRate:f||3}},d&&(c.video.mandatory.maxWidth=d),e&&(c.video.mandatory.maxHeight=e),a.navigator.mediaDevices.getUserMedia(c)})}}}function a6(a){a.MediaStream=a.MediaStream||a.webkitMediaStream}function a7(a){if("object"!=typeof a||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype)aW(a,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a));else{Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=b=>{b.stream.addEventListener("addtrack",c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.track.id):{track:c.track};let e=new Event("track");e.track=c.track,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)}),b.stream.getTracks().forEach(c=>{let d;d=a.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(a=>a.track&&a.track.id===c.id):{track:c};let e=new Event("track");e.track=c,e.receiver=d,e.transceiver={receiver:d},e.streams=[b.stream],this.dispatchEvent(e)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}}function a8(a){if("object"==typeof a&&a.RTCPeerConnection&&!("getSenders"in a.RTCPeerConnection.prototype)&&"createDTMFSender"in a.RTCPeerConnection.prototype){let b=function(a,b){return{track:b,get dtmf(){return void 0===this._dtmf&&("audio"===b.kind?this._dtmf=a.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:a}};if(!a.RTCPeerConnection.prototype.getSenders){a.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,d){let e=c.apply(this,arguments);return e||(e=b(this,a),this._senders.push(e)),e};let d=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){d.apply(this,arguments);let b=this._senders.indexOf(a);-1!==b&&this._senders.splice(b,1)}}let e=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],e.apply(this,[a]),a.getTracks().forEach(a=>{this._senders.push(b(this,a))})};let f=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],f.apply(this,[a]),a.getTracks().forEach(a=>{let b=this._senders.find(b=>b.track===a);b&&this._senders.splice(this._senders.indexOf(b),1)})}}else if("object"==typeof a&&a.RTCPeerConnection&&"getSenders"in a.RTCPeerConnection.prototype&&"createDTMFSender"in a.RTCPeerConnection.prototype&&a.RTCRtpSender&&!("dtmf"in a.RTCRtpSender.prototype)){let g=a.RTCPeerConnection.prototype.getSenders;a.RTCPeerConnection.prototype.getSenders=function(){let a=g.apply(this,[]);return a.forEach(a=>a._pc=this),a},Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function a9(a){if(!a.RTCPeerConnection)return;let b=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){let[a,c,d]=arguments;if(arguments.length>0&&"function"==typeof a)return b.apply(this,arguments);if(0===b.length&&(0===arguments.length||"function"!=typeof a))return b.apply(this,[]);let e=function(a){let b={},c=a.result();return c.forEach(a=>{let c={id:a.id,timestamp:a.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[a.type]||a.type};a.names().forEach(b=>{c[b]=a.stat(b)}),b[c.id]=c}),b},f=function(a){return new Map(Object.keys(a).map(b=>[b,a[b]]))};if(arguments.length>=2){let g=function(a){c(f(e(a)))};return b.apply(this,[g,a])}return new Promise((a,c)=>{b.apply(this,[function(b){a(f(e(b)))},c])}).then(c,d)}}function ba(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender&&a.RTCRtpReceiver))return;if(!("getStats"in a.RTCRtpSender.prototype)){let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>a2(b,a.track,!0))}}if(!("getStats"in a.RTCRtpReceiver.prototype)){let d=a.RTCPeerConnection.prototype.getReceivers;d&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=d.apply(this,[]);return a.forEach(a=>a._pc=this),a}),aW(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){let a=this;return this._pc.getStats().then(b=>a2(b,a.track,!1))}}if(!("getStats"in a.RTCRtpSender.prototype&&"getStats"in a.RTCRtpReceiver.prototype))return;let e=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof a.MediaStreamTrack){let b=arguments[0],c,d,f;return(this.getSenders().forEach(a=>{a.track===b&&(c?f=!0:c=a)}),this.getReceivers().forEach(a=>(a.track===b&&(d?f=!0:d=a),a.track===b)),f||c&&d)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):c?c.getStats():d?d.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function bb(a){a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let d=b.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(d)&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};let c=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(a=>{let b=this.getSenders().find(b=>b.track===a);if(b)throw new DOMException("Track already exists.","InvalidAccessError")});let b=this.getSenders();c.apply(this,arguments);let d=this.getSenders().filter(a=>-1===b.indexOf(a));this._shimmedLocalStreams[a.id]=[a].concat(d)};let d=a.RTCPeerConnection.prototype.removeStream;a.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],d.apply(this,arguments)};let e=a.RTCPeerConnection.prototype.removeTrack;a.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(b=>{let c=this._shimmedLocalStreams[b].indexOf(a);-1!==c&&this._shimmedLocalStreams[b].splice(c,1),1===this._shimmedLocalStreams[b].length&&delete this._shimmedLocalStreams[b]}),e.apply(this,arguments)}}function bc(a,b){if(!a.RTCPeerConnection)return;if(a.RTCPeerConnection.prototype.addTrack&&b.version>=65)return bb(a);let c=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){let a=c.apply(this);return this._reverseStreams=this._reverseStreams||{},a.map(a=>this._reverseStreams[a.id])};let d=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(b){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.getTracks().forEach(a=>{let b=this.getSenders().find(b=>b.track===a);if(b)throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[b.id]){let c=new a.MediaStream(b.getTracks());this._streams[b.id]=c,this._reverseStreams[c.id]=b,b=c}d.apply(this,[b])};let e=a.RTCPeerConnection.prototype.removeStream;function f(a,b){let c=b.sdp;return Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(e.id,"g"),d.id)}),new RTCSessionDescription({type:b.type,sdp:c})}a.RTCPeerConnection.prototype.removeStream=function(a){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.apply(this,[this._streams[a.id]||a]),delete this._reverseStreams[this._streams[a.id]?this._streams[a.id].id:a.id],delete this._streams[a.id]},a.RTCPeerConnection.prototype.addTrack=function(b,c){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(a=>a===b))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");let e=this.getSenders().find(a=>a.track===b);if(e)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let f=this._streams[c.id];if(f)f.addTrack(b),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let g=new a.MediaStream([b]);this._streams[c.id]=g,this._reverseStreams[g.id]=c,this.addStream(g)}return this.getSenders().find(a=>a.track===b)},["createOffer","createAnswer"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b],d={[b](){let a=arguments,b=arguments.length&&"function"==typeof arguments[0];return b?c.apply(this,[b=>{let c=f(this,b);a[0].apply(null,[c])},b=>{a[1]&&a[1].apply(null,b)},arguments[2]]):c.apply(this,arguments).then(a=>f(this,a))}};a.RTCPeerConnection.prototype[b]=d[b]});let g=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(){var a,b;if(!arguments.length||!arguments[0].type)return g.apply(this,arguments);let c;return arguments[0]=(a=this,b=arguments[0],c=b.sdp,Object.keys(a._reverseStreams||[]).forEach(b=>{let d=a._reverseStreams[b],e=a._streams[d.id];c=c.replace(RegExp(d.id,"g"),e.id)}),new RTCSessionDescription({type:b.type,sdp:c})),g.apply(this,arguments)};let h=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get(){let a=h.get.apply(this);return""===a.type?a:f(this,a)}}),a.RTCPeerConnection.prototype.removeTrack=function(a){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!a._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");let b=a._pc===this;if(!b)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let c;Object.keys(this._streams).forEach(b=>{let d=this._streams[b].getTracks().find(b=>a.track===b);d&&(c=this._streams[b])}),c&&(1===c.getTracks().length?this.removeStream(this._reverseStreams[c.id]):c.removeTrack(a.track),this.dispatchEvent(new Event("negotiationneeded")))}}function bd(a,b){!a.RTCPeerConnection&&a.webkitRTCPeerConnection&&(a.RTCPeerConnection=a.webkitRTCPeerConnection),a.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b],d={[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};a.RTCPeerConnection.prototype[b]=d[b]})}function be(a,b){aW(a,"negotiationneeded",a=>{let c=a.target;if(!(b.version<72)&&(!c.getConfiguration||"plan-b"!==c.getConfiguration().sdpSemantics)||"stable"===c.signalingState)return a})}var bf=c(7461),bg=c.n(bf);function bh(a){let b=a&&a.navigator,c=b.mediaDevices.getUserMedia.bind(b.mediaDevices);b.mediaDevices.getUserMedia=function(a){return c(a).catch(a=>{var b;return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(b=a).name]||b.name,message:b.message,constraint:b.constraint,toString(){return this.name}})})}}function bi(a){"getDisplayMedia"in a.navigator&&a.navigator.mediaDevices&&(!a.navigator.mediaDevices||!("getDisplayMedia"in a.navigator.mediaDevices))&&(a.navigator.mediaDevices.getDisplayMedia=a.navigator.getDisplayMedia.bind(a.navigator))}function bj(a,b){if(a.RTCIceGatherer&&(a.RTCIceCandidate||(a.RTCIceCandidate=function(a){return a}),a.RTCSessionDescription||(a.RTCSessionDescription=function(a){return a}),b.version<15025)){let c=Object.getOwnPropertyDescriptor(a.MediaStreamTrack.prototype,"enabled");Object.defineProperty(a.MediaStreamTrack.prototype,"enabled",{set(a){c.set.call(this,a);let b=new Event("enabled");b.enabled=a,this.dispatchEvent(b)}})}!a.RTCRtpSender||"dtmf"in a.RTCRtpSender.prototype||Object.defineProperty(a.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new a.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),a.RTCDtmfSender&&!a.RTCDTMFSender&&(a.RTCDTMFSender=a.RTCDtmfSender);let d=bg()(a,b.version);a.RTCPeerConnection=function(a){if(a&&a.iceServers){var c,e;let f;a.iceServers=(c=a.iceServers,b.version,f=!1,(c=JSON.parse(JSON.stringify(c))).filter(a=>{if(a&&(a.urls||a.url)){let b=a.urls||a.url;a.url&&!a.urls&&a$("RTCIceServer.url","RTCIceServer.urls");let c="string"==typeof b;return c&&(b=[b]),b=b.filter(a=>{if(0===a.indexOf("stun:"))return!1;let b=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return b&&!f?(f=!0,!0):b&&!f}),delete a.url,a.urls=c?b[0]:b,!!b.length}})),aZ("ICE servers after filtering:",a.iceServers)}return new d(a)},a.RTCPeerConnection.prototype=d.prototype}function bk(a){!a.RTCRtpSender||"replaceTrack"in a.RTCRtpSender.prototype||(a.RTCRtpSender.prototype.replaceTrack=a.RTCRtpSender.prototype.setTrack)}function bl(a,b){let c=a&&a.navigator,d=a&&a.MediaStreamTrack;if(c.getUserMedia=function(a,b,d){a$("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(a).then(b,d)},!(b.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){let e=function(a,b,c){b in a&&!(c in a)&&(a[c]=a[b],delete a[b])},f=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(e((a=JSON.parse(JSON.stringify(a))).audio,"autoGainControl","mozAutoGainControl"),e(a.audio,"noiseSuppression","mozNoiseSuppression")),f(a)},d&&d.prototype.getSettings){let g=d.prototype.getSettings;d.prototype.getSettings=function(){let a=g.apply(this,arguments);return e(a,"mozAutoGainControl","autoGainControl"),e(a,"mozNoiseSuppression","noiseSuppression"),a}}if(d&&d.prototype.applyConstraints){let h=d.prototype.applyConstraints;d.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(e(a=JSON.parse(JSON.stringify(a)),"autoGainControl","mozAutoGainControl"),e(a,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[a])}}}}function bm(a,b){(!a.navigator.mediaDevices||!("getDisplayMedia"in a.navigator.mediaDevices))&&a.navigator.mediaDevices&&(a.navigator.mediaDevices.getDisplayMedia=function(c){if(!(c&&c.video)){let d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,Promise.reject(d)}return!0===c.video?c.video={mediaSource:b}:c.video.mediaSource=b,a.navigator.mediaDevices.getUserMedia(c)})}function bn(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bo(a,b){if("object"!=typeof a||!(a.RTCPeerConnection||a.mozRTCPeerConnection))return;!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){let c=a.RTCPeerConnection.prototype[b],d={[b](){return arguments[0]=new("addIceCandidate"===b?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};a.RTCPeerConnection.prototype[b]=d[b]});let c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(){let[a,e,f]=arguments;return d.apply(this,[a||null]).then(a=>{if(b.version<53&&!e)try{a.forEach(a=>{a.type=c[a.type]||a.type})}catch(d){if("TypeError"!==d.name)throw d;a.forEach((b,d)=>{a.set(d,Object.assign({},b,{type:c[b.type]||b.type}))})}return a}).then(e,f)}}function bp(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpSender.prototype)return;let b=a.RTCPeerConnection.prototype.getSenders;b&&(a.RTCPeerConnection.prototype.getSenders=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a});let c=a.RTCPeerConnection.prototype.addTrack;c&&(a.RTCPeerConnection.prototype.addTrack=function(){let a=c.apply(this,arguments);return a._pc=this,a}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function bq(a){if(!("object"==typeof a&&a.RTCPeerConnection&&a.RTCRtpSender)||a.RTCRtpSender&&"getStats"in a.RTCRtpReceiver.prototype)return;let b=a.RTCPeerConnection.prototype.getReceivers;b&&(a.RTCPeerConnection.prototype.getReceivers=function(){let a=b.apply(this,[]);return a.forEach(a=>a._pc=this),a}),aW(a,"track",a=>(a.receiver._pc=a.srcElement,a)),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function br(a){a.RTCPeerConnection&&!("removeStream"in a.RTCPeerConnection.prototype)&&(a.RTCPeerConnection.prototype.removeStream=function(a){a$("removeStream","removeTrack"),this.getSenders().forEach(b=>{b.track&&a.getTracks().includes(b.track)&&this.removeTrack(b)})})}function bs(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)}function bt(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.addTransceiver;b&&(a.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1],c=a&&"sendEncodings"in a;c&&a.sendEncodings.forEach(a=>{if("rid"in a){let b=/^[a-z0-9]{0,16}$/i;if(!b.test(a.rid))throw TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let d=b.apply(this,arguments);if(c){let{sender:e}=d,f=e.getParameters();"encodings"in f&&(1!==f.encodings.length||0!==Object.keys(f.encodings[0]).length)||(f.encodings=a.sendEncodings,e.sendEncodings=a.sendEncodings,this.setParametersPromises.push(e.setParameters(f).then(()=>{delete e.sendEncodings}).catch(()=>{delete e.sendEncodings})))}return d})}function bu(a){if(!("object"==typeof a&&a.RTCRtpSender))return;let b=a.RTCRtpSender.prototype.getParameters;b&&(a.RTCRtpSender.prototype.getParameters=function(){let a=b.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function bv(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function bw(a){if(!("object"==typeof a&&a.RTCPeerConnection))return;let b=a.RTCPeerConnection.prototype.createAnswer;a.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function bx(a){if("object"==typeof a&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in a.RTCPeerConnection.prototype)){let b=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(c=>b.call(this,c,a)),a.getVideoTracks().forEach(c=>b.call(this,c,a))},a.RTCPeerConnection.prototype.addTrack=function(a,...c){return c&&c.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),b.apply(this,arguments)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(a){this._localStreams||(this._localStreams=[]);let b=this._localStreams.indexOf(a);if(-1===b)return;this._localStreams.splice(b,1);let c=a.getTracks();this.getSenders().forEach(a=>{c.includes(a.track)&&this.removeTrack(a)})})}}function by(a){if("object"==typeof a&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);let b=new Event("addstream");b.stream=a,this.dispatchEvent(b)})})}});let b=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){let a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(b){b.streams.forEach(b=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(b)>=0)return;a._remoteStreams.push(b);let c=new Event("addstream");c.stream=b,a.dispatchEvent(c)})}),b.apply(a,arguments)}}}function bz(a){if("object"!=typeof a||!a.RTCPeerConnection)return;let b=a.RTCPeerConnection.prototype,c=b.createOffer,d=b.createAnswer,e=b.setLocalDescription,f=b.setRemoteDescription,g=b.addIceCandidate;b.createOffer=function(a,b){let d=arguments.length>=2?arguments[2]:arguments[0],e=c.apply(this,[d]);return b?(e.then(a,b),Promise.resolve()):e},b.createAnswer=function(a,b){let c=arguments.length>=2?arguments[2]:arguments[0],e=d.apply(this,[c]);return b?(e.then(a,b),Promise.resolve()):e};let h=function(a,b,c){let d=e.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d};b.setLocalDescription=h,h=function(a,b,c){let d=f.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.setRemoteDescription=h,h=function(a,b,c){let d=g.apply(this,[a]);return c?(d.then(b,c),Promise.resolve()):d},b.addIceCandidate=h}function bA(a){let b=a&&a.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){let c=b.mediaDevices,d=c.getUserMedia.bind(c);b.mediaDevices.getUserMedia=a=>d(bB(a))}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=(function(a,c,d){b.mediaDevices.getUserMedia(a).then(c,d)}).bind(b))}function bB(a){return a&& void 0!==a.video?Object.assign({},a,{video:a0(a.video)}):a}function bC(a){if(!a.RTCPeerConnection)return;let b=a.RTCPeerConnection;a.RTCPeerConnection=function(a,c){if(a&&a.iceServers){let d=[];for(let e=0;e<a.iceServers.length;e++){let f=a.iceServers[e];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(a$("RTCIceServer.url","RTCIceServer.urls"),(f=JSON.parse(JSON.stringify(f))).urls=f.url,delete f.url,d.push(f)):d.push(a.iceServers[e])}a.iceServers=d}return new b(a,c)},a.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get(){return b.generateCertificate}})}function bD(a){"object"==typeof a&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bE(a){let b=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(a){if(a){void 0!==a.offerToReceiveAudio&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);let c=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===a.offerToReceiveAudio&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==a.offerToReceiveAudio||c||this.addTransceiver("audio"),void 0!==a.offerToReceiveVideo&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);let d=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===a.offerToReceiveVideo&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==a.offerToReceiveVideo||d||this.addTransceiver("video")}return b.apply(this,arguments)}}function bF(a){"object"==typeof a&&!a.AudioContext&&(a.AudioContext=a.webkitAudioContext)}var bG=c(4435),bH=c.n(bG);function bI(a){if(!a.RTCIceCandidate||a.RTCIceCandidate&&"foundation"in a.RTCIceCandidate.prototype)return;let b=a.RTCIceCandidate;a.RTCIceCandidate=function(a){if("object"==typeof a&&a.candidate&&0===a.candidate.indexOf("a=")&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){let c=new b(a),d=bH().parseCandidate(a.candidate),e=Object.assign(c,d);return e.toJSON=function(){return{candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment}},e}return new b(a)},a.RTCIceCandidate.prototype=b.prototype,aW(a,"icecandidate",b=>(b.candidate&&Object.defineProperty(b,"candidate",{value:new a.RTCIceCandidate(b.candidate),writable:"false"}),b))}function bJ(a,b){if(!a.RTCPeerConnection)return;"sctp"in a.RTCPeerConnection.prototype||Object.defineProperty(a.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let c=function(a){if(!a||!a.sdp)return!1;let b=bH().splitSections(a.sdp);return b.shift(),b.some(a=>{let b=bH().parseMLine(a);return b&&"application"===b.kind&& -1!==b.protocol.indexOf("SCTP")})},d=function(a){let b=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===b||b.length<2)return -1;let c=parseInt(b[1],10);return c!=c?-1:c},e=function(a){let c=65536;return"firefox"===b.browser&&(c=b.version<57?-1===a?16384:2147483637:b.version<60?57===b.version?65535:65536:2147483637),c},f=function(a,c){let d=65536;"firefox"===b.browser&&57===b.version&&(d=65535);let e=bH().matchPrefix(a.sdp,"a=max-message-size:");return e.length>0?d=parseInt(e[0].substr(19),10):"firefox"===b.browser&& -1!==c&&(d=2147483637),d},g=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===b.browser&&b.version>=76){let{sdpSemantics:a}=this.getConfiguration();"plan-b"===a&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(c(arguments[0])){let h=d(arguments[0]),i=e(h),j=f(arguments[0],h),k;k=0===i&&0===j?Number.POSITIVE_INFINITY:0===i||0===j?Math.max(i,j):Math.min(i,j);let l={};Object.defineProperty(l,"maxMessageSize",{get(){return k}}),this._sctp=l}return g.apply(this,arguments)}}function bK(a){if(!(a.RTCPeerConnection&&"createDataChannel"in a.RTCPeerConnection.prototype))return;function b(a,b){let c=a.send;a.send=function(){let d=arguments[0],e=d.length||d.size||d.byteLength;if("open"===a.readyState&&b.sctp&&e>b.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return c.apply(a,arguments)}}let c=a.RTCPeerConnection.prototype.createDataChannel;a.RTCPeerConnection.prototype.createDataChannel=function(){let a=c.apply(this,arguments);return b(a,this),a},aW(a,"datachannel",a=>(b(a.channel,a.target),a))}function bL(a){if(!a.RTCPeerConnection||"connectionState"in a.RTCPeerConnection.prototype)return;let b=a.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(a=>{let c=b[a];b[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{let b=a.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;let c=new Event("connectionstatechange",a);b.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function bM(a,b){if(!a.RTCPeerConnection||"chrome"===b.browser&&b.version>=71||"safari"===b.browser&&b.version>=605)return;let c=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(b){if(b&&b.sdp&& -1!==b.sdp.indexOf("\na=extmap-allow-mixed")){let d=b.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");a.RTCSessionDescription&&b instanceof a.RTCSessionDescription?arguments[0]=new a.RTCSessionDescription({type:b.type,sdp:d}):b.sdp=d}return c.apply(this,arguments)}}function bN(a,b){if(!(a.RTCPeerConnection&&a.RTCPeerConnection.prototype))return;let c=a.RTCPeerConnection.prototype.addIceCandidate;c&&0!==c.length&&(a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===b.browser&&b.version<78||"firefox"===b.browser&&b.version<68||"safari"===b.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}let bO=function({window:a}={},b={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let c=aZ,d=function(a){let b={browser:null,version:null};if(void 0===a||!a.navigator)return b.browser="Not a browser.",b;let{navigator:c}=a;return c.mozGetUserMedia?(b.browser="firefox",b.version=aV(c.userAgent,/Firefox\/(\d+)\./,1)):c.webkitGetUserMedia|| !1===a.isSecureContext&&a.webkitRTCPeerConnection&&!a.RTCIceGatherer?(b.browser="chrome",b.version=aV(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/)?(b.browser="edge",b.version=aV(c.userAgent,/Edge\/(\d+).(\d+)$/,2)):a.RTCPeerConnection&&c.userAgent.match(/AppleWebKit\/(\d+)\./)?(b.browser="safari",b.version=aV(c.userAgent,/AppleWebKit\/(\d+)\./,1),b.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype):b.browser="Not a supported browser.",b}(a),e={browserDetails:d,commonShim:t,extractVersion:aV,disableLog:aX,disableWarnings:aY};switch(d.browser){case"chrome":if(!p||!bd||!b.shimChrome){c("Chrome shim is not included in this adapter release.");break}if(null===d.version){c("Chrome shim can not determine version, not shimming.");break}c("adapter.js shimming chrome."),e.browserShim=p,bN(a,d),a4(a,d),a6(a,d),bd(a,d),a7(a,d),bc(a,d),a8(a,d),a9(a,d),ba(a,d),be(a,d),bI(a,d),bL(a,d),bJ(a,d),bK(a,d),bM(a,d);break;case"firefox":if(!r||!bo||!b.shimFirefox){c("Firefox shim is not included in this adapter release.");break}c("adapter.js shimming firefox."),e.browserShim=r,bN(a,d),bl(a,d),bo(a,d),bn(a,d),br(a,d),bp(a,d),bq(a,d),bs(a,d),bt(a,d),bu(a,d),bv(a,d),bw(a,d),bI(a,d),bL(a,d),bJ(a,d),bK(a,d);break;case"edge":if(!q||!bj||!b.shimEdge){c("MS edge shim is not included in this adapter release.");break}c("adapter.js shimming edge."),e.browserShim=q,bh(a,d),bi(a,d),bj(a,d),bk(a,d),bJ(a,d),bK(a,d);break;case"safari":if(!s||!b.shimSafari){c("Safari shim is not included in this adapter release.");break}c("adapter.js shimming safari."),e.browserShim=s,bN(a,d),bC(a,d),bE(a,d),bz(a,d),bx(a,d),by(a,d),bD(a,d),bA(a,d),bF(a,d),bI(a,d),bJ(a,d),bK(a,d),bM(a,d);break;default:c("Unsupported browser!")}return e}({window:"undefined"==typeof window?void 0:window});var bP=bO;function bQ(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}var bR,bS=bP.default||bP,bT=new(function(){function a(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return a.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},a.prototype.isBrowserSupported=function(){var a=this.getBrowser(),b=this.getVersion();return!!this.supportedBrowsers.includes(a)&&("chrome"===a?b>=this.minChromeVersion:"firefox"===a?b>=this.minFirefoxVersion:"safari"===a&&!this.isIOS&&b>=this.minSafariVersion)},a.prototype.getBrowser=function(){return bS.browserDetails.browser},a.prototype.getVersion=function(){return bS.browserDetails.version||0},a.prototype.isUnifiedPlanSupported=function(){var a,b=this.getBrowser(),c=bS.browserDetails.version||0;if("chrome"===b&&c<this.minChromeVersion)return!1;if("firefox"===b&&c>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var d=!1;try{(a=new RTCPeerConnection).addTransceiver("audio"),d=!0}catch(e){}finally{a&&a.close()}return d},a.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},a}()),bU={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478",],username:"peerjs",credential:"peerjsp"},],sdpSemantics:"unified-plan"},bV=new(function(){function a(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=bU,this.browser=bT.getBrowser(),this.browserVersion=bT.getVersion(),this.supports=function(){var a,b={browser:bT.isBrowserSupported(),webRTC:bT.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!b.webRTC)return b;try{a=new RTCPeerConnection(bU),b.audioVideo=!0;var c=void 0;try{c=a.createDataChannel("_PEERJSTEST",{ordered:!0}),b.data=!0,b.reliable=!!c.ordered;try{c.binaryType="blob",b.binaryBlob=!bT.isIOS}catch(d){}}catch(e){}finally{c&&c.close()}}catch(f){}finally{a&&a.close()}return b}(),this.pack=aS.pack,this.unpack=aS.unpack,this._dataCount=1}return a.prototype.noop=function(){},a.prototype.validateId=function(a){return!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(a)},a.prototype.chunk=function(a){for(var b=[],c=a.size,d=Math.ceil(c/bV.chunkedMTU),e=0,f=0;f<c;){var g=Math.min(c,f+bV.chunkedMTU),h=a.slice(f,g),i={__peerData:this._dataCount,n:e,data:h,total:d};b.push(i),f=g,e++}return this._dataCount++,b},a.prototype.blobToArrayBuffer=function(a,b){var c=new FileReader;return c.onload=function(a){a.target&&b(a.target.result)},c.readAsArrayBuffer(a),c},a.prototype.binaryStringToArrayBuffer=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=255&a.charCodeAt(c);return b.buffer},a.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},a.prototype.isSecure=function(){return"https:"===location.protocol},a}()),bW={};bQ(bW,"Peer",()=>cS,a=>cS=a);var bX={},bY=Object.prototype.hasOwnProperty,bZ="~";function b$(){}function b_(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function b0(a,b,c,d,e){if("function"!=typeof c)throw TypeError("The listener must be a function");var f=new b_(c,d||a,e),g=bZ?bZ+b:b;return a._events[g]?a._events[g].fn?a._events[g]=[a._events[g],f]:a._events[g].push(f):(a._events[g]=f,a._eventsCount++),a}function b1(a,b){0== --a._eventsCount?a._events=new b$:delete a._events[b]}function b2(){this._events=new b$,this._eventsCount=0}Object.create&&(b$.prototype=Object.create(null),new b$().__proto__||(bZ=!1)),b2.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)bY.call(a,b)&&c.push(bZ?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},b2.prototype.listeners=function(a){var b=bZ?bZ+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=Array(e);d<e;d++)f[d]=c[d].fn;return f},b2.prototype.listenerCount=function(a){var b=bZ?bZ+a:a,c=this._events[b];return c?c.fn?1:c.length:0},b2.prototype.emit=function(a,b,c,d,e,f){var g=bZ?bZ+a:a;if(!this._events[g])return!1;var h,i,j=this._events[g],k=arguments.length;if(j.fn){switch(j.once&&this.removeListener(a,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,b),!0;case 3:return j.fn.call(j.context,b,c),!0;case 4:return j.fn.call(j.context,b,c,d),!0;case 5:return j.fn.call(j.context,b,c,d,e),!0;case 6:return j.fn.call(j.context,b,c,d,e,f),!0}for(i=1,h=Array(k-1);i<k;i++)h[i-1]=arguments[i];j.fn.apply(j.context,h)}else{var l,m=j.length;for(i=0;i<m;i++)switch(j[i].once&&this.removeListener(a,j[i].fn,void 0,!0),k){case 1:j[i].fn.call(j[i].context);break;case 2:j[i].fn.call(j[i].context,b);break;case 3:j[i].fn.call(j[i].context,b,c);break;case 4:j[i].fn.call(j[i].context,b,c,d);break;default:if(!h)for(l=1,h=Array(k-1);l<k;l++)h[l-1]=arguments[l];j[i].fn.apply(j[i].context,h)}}return!0},b2.prototype.on=function(a,b,c){return b0(this,a,b,c,!1)},b2.prototype.once=function(a,b,c){return b0(this,a,b,c,!0)},b2.prototype.removeListener=function(a,b,c,d){var e=bZ?bZ+a:a;if(!this._events[e])return this;if(!b)return b1(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||b1(this,e);else{for(var g=0,h=[],i=f.length;g<i;g++)(f[g].fn!==b||d&&!f[g].once||c&&f[g].context!==c)&&h.push(f[g]);h.length?this._events[e]=1===h.length?h[0]:h:b1(this,e)}return this},b2.prototype.removeAllListeners=function(a){var b;return a?(b=bZ?bZ+a:a,this._events[b]&&b1(this,b)):(this._events=new b$,this._eventsCount=0),this},b2.prototype.off=b2.prototype.removeListener,b2.prototype.addListener=b2.prototype.on,b2.prefixed=bZ,b2.EventEmitter=b2,bX=b2;var b3={};bQ(b3,"LogLevel",()=>g,a=>g=a),bQ(b3,"default",()=>cc,a=>cc=a);var b4,b5=function(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(h){e={error:h}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g},b6=function(a,b,c){if(c||2===arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))};(b4=g||(g={}))[b4.Disabled=0]="Disabled",b4[b4.Errors=1]="Errors",b4[b4.Warnings=2]="Warnings",b4[b4.All=3]="All";var b7,b8,b9,ca,cb,cc=new(function(){function a(){this._logLevel=g.Disabled}return Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(a){this._logLevel=a},enumerable:!1,configurable:!0}),a.prototype.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._logLevel>=g.All&&this._print.apply(this,b6([g.All],b5(a),!1))},a.prototype.warn=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._logLevel>=g.Warnings&&this._print.apply(this,b6([g.Warnings],b5(a),!1))},a.prototype.error=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this._logLevel>=g.Errors&&this._print.apply(this,b6([g.Errors],b5(a),!1))},a.prototype.setLogFunction=function(a){this._print=a},a.prototype._print=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=b6(["PeerJS: "],b5(b),!1);for(var e in d)d[e]instanceof Error&&(d[e]="("+d[e].name+") "+d[e].message);a>=g.All?console.log.apply(console,b6([],b5(d),!1)):a>=g.Warnings?console.warn.apply(console,b6(["WARNING"],b5(d),!1)):a>=g.Errors&&console.error.apply(console,b6(["ERROR"],b5(d),!1))},a}()),cd={};bQ(cd,"Socket",()=>ck,a=>ck=a),(b7=h||(h={})).Data="data",b7.Media="media",(b8=i||(i={})).BrowserIncompatible="browser-incompatible",b8.Disconnected="disconnected",b8.InvalidID="invalid-id",b8.InvalidKey="invalid-key",b8.Network="network",b8.PeerUnavailable="peer-unavailable",b8.SslUnavailable="ssl-unavailable",b8.ServerError="server-error",b8.SocketError="socket-error",b8.SocketClosed="socket-closed",b8.UnavailableID="unavailable-id",b8.WebRTC="webrtc",(b9=j||(j={})).Binary="binary",b9.BinaryUTF8="binary-utf8",b9.JSON="json",(ca=k||(k={})).Message="message",ca.Disconnected="disconnected",ca.Error="error",ca.Close="close",(cb=l||(l={})).Heartbeat="HEARTBEAT",cb.Candidate="CANDIDATE",cb.Offer="OFFER",cb.Answer="ANSWER",cb.Open="OPEN",cb.Error="ERROR",cb.IdTaken="ID-TAKEN",cb.InvalidKey="INVALID-KEY",cb.Leave="LEAVE",cb.Expire="EXPIRE";var ce,cf={};cf=JSON.parse('{"name":"peerjs","version":"1.4.6","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xfcckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"type":"module","sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.cjs","browser-unminified":"dist/peerjs.cjs","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"includeNodeModules":true,"context":"browser","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"includeNodeModules":true,"context":"browser","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build && cp dist/peerjs.cjs dist/peerjs.js && cp dist/peerjs.min.cjs dist/peerjs.min.js","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var cg=(ce=function(a,b){return(ce=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}ce(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),ch=function(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(h){e={error:h}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g},ci=function(a,b,c){if(c||2===arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))},cj=function(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},ck=function(a){function b(b,c,d,e,f,g){void 0===g&&(g=5e3);var h=a.call(this)||this;return h.pingInterval=g,h._disconnected=!0,h._messagesQueue=[],h._baseUrl=(b?"wss://":"ws://")+c+":"+d+e+"peerjs?key="+f,h}return cg(b,a),b.prototype.start=function(a,b){var c=this;this._id=a;var d="".concat(this._baseUrl,"&id=").concat(a,"&token=").concat(b);!this._socket&&this._disconnected&&(this._socket=new WebSocket(d+"&version="+cf.version),this._disconnected=!1,this._socket.onmessage=function(a){var b;try{b=JSON.parse(a.data),b3.default.log("Server message received:",b)}catch(d){b3.default.log("Invalid server message",a.data);return}c.emit(k.Message,b)},this._socket.onclose=function(a){c._disconnected||(b3.default.log("Socket closed.",a),c._cleanup(),c._disconnected=!0,c.emit(k.Disconnected))},this._socket.onopen=function(){c._disconnected||(c._sendQueuedMessages(),b3.default.log("Socket open"),c._scheduleHeartbeat())})},b.prototype._scheduleHeartbeat=function(){var a=this;this._wsPingTimer=setTimeout(function(){a._sendHeartbeat()},this.pingInterval)},b.prototype._sendHeartbeat=function(){if(!this._wsOpen()){b3.default.log("Cannot send heartbeat, because socket closed");return}var a=JSON.stringify({type:l.Heartbeat});this._socket.send(a),this._scheduleHeartbeat()},b.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},b.prototype._sendQueuedMessages=function(){var a,b,c=ci([],ch(this._messagesQueue),!1);this._messagesQueue=[];try{for(var d=cj(c),e=d.next();!e.done;e=d.next()){var f=e.value;this.send(f)}}catch(g){a={error:g}}finally{try{e&&!e.done&&(b=d.return)&&b.call(d)}finally{if(a)throw a.error}}},b.prototype.send=function(a){if(!this._disconnected){if(!this._id){this._messagesQueue.push(a);return}if(!a.type){this.emit(k.Error,"Invalid message");return}if(this._wsOpen()){var b=JSON.stringify(a);this._socket.send(b)}}},b.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},b.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},b}(bX.EventEmitter),cl={};bQ(cl,"MediaConnection",()=>cz,a=>cz=a);var cm={};bQ(cm,"Negotiator",()=>cr,a=>cr=a);var cn,co=function(){return(co=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},cp=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(b){f(b)}}function h(a){try{i(d.throw(a))}catch(b){f(b)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},cq=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(a){return function(b){return i([a,b])}}function i(f){if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;switch(d=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===f[0]||2===f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}e[2]&&g.ops.pop(),g.trys.pop();continue}f=b.call(a,g)}catch(h){f=[6,h],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},cr=function(){function a(a){this.connection=a}return a.prototype.startConnection=function(a){var b=this._startPeerConnection();if(this.connection.peerConnection=b,this.connection.type===h.Media&&a._stream&&this._addTracksToConnection(a._stream,b),a.originator){if(this.connection.type===h.Data){var c=this.connection,d={ordered:!!a.reliable},e=b.createDataChannel(c.label,d);c.initialize(e)}this._makeOffer()}else this.handleSDP("OFFER",a.sdp)},a.prototype._startPeerConnection=function(){b3.default.log("Creating RTCPeerConnection.");var a=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(a),a},a.prototype._setupListeners=function(a){var b=this,c=this.connection.peer,d=this.connection.connectionId,e=this.connection.type,f=this.connection.provider;b3.default.log("Listening for ICE candidates."),a.onicecandidate=function(a){a.candidate&&a.candidate.candidate&&(b3.default.log("Received ICE candidates for ".concat(c,":"),a.candidate),f.socket.send({type:l.Candidate,payload:{candidate:a.candidate,type:e,connectionId:d},dst:c}))},a.oniceconnectionstatechange=function(){switch(a.iceConnectionState){case"failed":b3.default.log("iceConnectionState is failed, closing connections to "+c),b.connection.emit("error",Error("Negotiation of connection to "+c+" failed.")),b.connection.close();break;case"closed":b3.default.log("iceConnectionState is closed, closing connections to "+c),b.connection.emit("error",Error("Connection to "+c+" closed.")),b.connection.close();break;case"disconnected":b3.default.log("iceConnectionState changed to disconnected on the connection with "+c);break;case"completed":a.onicecandidate=bV.noop}b.connection.emit("iceStateChanged",a.iceConnectionState)},b3.default.log("Listening for data channel"),a.ondatachannel=function(a){b3.default.log("Received data channel");var b=a.channel;f.getConnection(c,d).initialize(b)},b3.default.log("Listening for remote stream"),a.ontrack=function(a){b3.default.log("Received remote stream");var e=a.streams[0],g=f.getConnection(c,d);if(g.type===h.Media){var i=g;b._addStreamToMediaConnection(e,i)}}},a.prototype.cleanup=function(){b3.default.log("Cleaning up PeerConnection to "+this.connection.peer);var a=this.connection.peerConnection;if(a){this.connection.peerConnection=null,a.onicecandidate=a.oniceconnectionstatechange=a.ondatachannel=a.ontrack=function(){};var b="closed"!==a.signalingState,c=!1;if(this.connection.type===h.Data){var d=this.connection.dataChannel;d&&(c=!!d.readyState&&"closed"!==d.readyState)}(b||c)&&a.close()}},a.prototype._makeOffer=function(){return cp(this,void 0,Promise,function(){var a,b,c,d,e,f,g;return cq(this,function(j){switch(j.label){case 0:a=this.connection.peerConnection,b=this.connection.provider,j.label=1;case 1:return j.trys.push([1,7,,8]),[4,a.createOffer(this.connection.options.constraints)];case 2:c=j.sent(),b3.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp),j.label=3;case 3:return j.trys.push([3,5,,6]),[4,a.setLocalDescription(c)];case 4:return j.sent(),b3.default.log("Set localDescription:",c,"for:".concat(this.connection.peer)),d={sdp:c,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:bV.browser},this.connection.type===h.Data&&(e=this.connection,d=co(co({},d),{label:e.label,reliable:e.reliable,serialization:e.serialization})),b.socket.send({type:l.Offer,payload:d,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(f=j.sent())&&(b.emitError(i.WebRTC,f),b3.default.log("Failed to setLocalDescription, ",f)),[3,6];case 6:return[3,8];case 7:return g=j.sent(),b.emitError(i.WebRTC,g),b3.default.log("Failed to createOffer, ",g),[3,8];case 8:return[2]}})})},a.prototype._makeAnswer=function(){return cp(this,void 0,Promise,function(){var a,b,c,d,e;return cq(this,function(f){switch(f.label){case 0:a=this.connection.peerConnection,b=this.connection.provider,f.label=1;case 1:return f.trys.push([1,7,,8]),[4,a.createAnswer()];case 2:c=f.sent(),b3.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(c.sdp=this.connection.options.sdpTransform(c.sdp)||c.sdp),f.label=3;case 3:return f.trys.push([3,5,,6]),[4,a.setLocalDescription(c)];case 4:return f.sent(),b3.default.log("Set localDescription:",c,"for:".concat(this.connection.peer)),b.socket.send({type:l.Answer,payload:{sdp:c,type:this.connection.type,connectionId:this.connection.connectionId,browser:bV.browser},dst:this.connection.peer}),[3,6];case 5:return d=f.sent(),b.emitError(i.WebRTC,d),b3.default.log("Failed to setLocalDescription, ",d),[3,6];case 6:return[3,8];case 7:return e=f.sent(),b.emitError(i.WebRTC,e),b3.default.log("Failed to create answer, ",e),[3,8];case 8:return[2]}})})},a.prototype.handleSDP=function(a,b){return cp(this,void 0,Promise,function(){var c,d,e,f;return cq(this,function(g){switch(g.label){case 0:b=new RTCSessionDescription(b),c=this.connection.peerConnection,d=this.connection.provider,b3.default.log("Setting remote description",b),e=this,g.label=1;case 1:return g.trys.push([1,5,,6]),[4,c.setRemoteDescription(b)];case 2:if(g.sent(),b3.default.log("Set remoteDescription:".concat(a," for:").concat(this.connection.peer)),"OFFER"!==a)return[3,4];return[4,e._makeAnswer()];case 3:g.sent(),g.label=4;case 4:return[3,6];case 5:return f=g.sent(),d.emitError(i.WebRTC,f),b3.default.log("Failed to setRemoteDescription, ",f),[3,6];case 6:return[2]}})})},a.prototype.handleCandidate=function(a){return cp(this,void 0,Promise,function(){var b,c,d,e,f,g;return cq(this,function(h){switch(h.label){case 0:b3.default.log("handleCandidate:",a),b=a.candidate,c=a.sdpMLineIndex,d=a.sdpMid,e=this.connection.peerConnection,f=this.connection.provider,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,e.addIceCandidate(new RTCIceCandidate({sdpMid:d,sdpMLineIndex:c,candidate:b}))];case 2:return h.sent(),b3.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return g=h.sent(),f.emitError(i.WebRTC,g),b3.default.log("Failed to handleCandidate, ",g),[3,4];case 4:return[2]}})})},a.prototype._addTracksToConnection=function(a,b){if(b3.default.log("add tracks from stream ".concat(a.id," to peer connection")),!b.addTrack)return b3.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");a.getTracks().forEach(function(c){b.addTrack(c,a)})},a.prototype._addStreamToMediaConnection=function(a,b){b3.default.log("add stream ".concat(a.id," to media connection ").concat(b.connectionId)),b.addStream(a)},a}(),cs={};bQ(cs,"BaseConnection",()=>cv,a=>cv=a);var ct,cu=(cn=function(a,b){return(cn=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}cn(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),cv=function(a){function b(b,c,d){var e=a.call(this)||this;return e.peer=b,e.provider=c,e.options=d,e._open=!1,e.metadata=d.metadata,e}return cu(b,a),Object.defineProperty(b.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),b}(bX.EventEmitter),cw=(ct=function(a,b){return(ct=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}ct(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),cx=function(){return(cx=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},cy=function(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},cz=function(a){function b(c,d,e){var f=a.call(this,c,d,e)||this;return f._localStream=f.options._stream,f.connectionId=f.options.connectionId||b.ID_PREFIX+bV.randomToken(),f._negotiator=new cm.Negotiator(f),f._localStream&&f._negotiator.startConnection({_stream:f._localStream,originator:!0}),f}return cw(b,a),Object.defineProperty(b.prototype,"type",{get:function(){return h.Media},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),b.prototype.addStream=function(b){b3.default.log("Receiving stream",b),this._remoteStream=b,a.prototype.emit.call(this,"stream",b)},b.prototype.handleMessage=function(a){var b=a.type,c=a.payload;switch(a.type){case l.Answer:this._negotiator.handleSDP(b,c.sdp),this._open=!0;break;case l.Candidate:this._negotiator.handleCandidate(c.candidate);break;default:b3.default.warn("Unrecognized message type:".concat(b," from peer:").concat(this.peer))}},b.prototype.answer=function(a,b){if(void 0===b&&(b={}),this._localStream){b3.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=a,b&&b.sdpTransform&&(this.options.sdpTransform=b.sdpTransform),this._negotiator.startConnection(cx(cx({},this.options._payload),{_stream:a}));var c,d,e=this.provider._getMessages(this.connectionId);try{for(var f=cy(e),g=f.next();!g.done;g=f.next()){var h=g.value;this.handleMessage(h)}}catch(i){c={error:i}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}this._open=!0},b.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,a.prototype.emit.call(this,"close"))},b.ID_PREFIX="mc_",b}(cs.BaseConnection),cA={};bQ(cA,"DataConnection",()=>cI,a=>cI=a);var cB,cC={};bQ(cC,"EncodingQueue",()=>cF,a=>cF=a);var cD,cE=(cB=function(a,b){return(cB=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}cB(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),cF=function(a){function b(){var b=a.call(this)||this;return b.fileReader=new FileReader,b._queue=[],b._processing=!1,b.fileReader.onload=function(a){b._processing=!1,a.target&&b.emit("done",a.target.result),b.doNextTask()},b.fileReader.onerror=function(a){b3.default.error("EncodingQueue error:",a),b._processing=!1,b.destroy(),b.emit("error",a)},b}return cE(b,a),Object.defineProperty(b.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),b.prototype.enque=function(a){this.queue.push(a),this.processing||this.doNextTask()},b.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},b.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},b}(bX.EventEmitter),cG=(cD=function(a,b){return(cD=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}cD(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),cH=function(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},cI=function(a){function b(c,d,e){var f=a.call(this,c,d,e)||this;return f.stringify=JSON.stringify,f.parse=JSON.parse,f._buffer=[],f._bufferSize=0,f._buffering=!1,f._chunkedData={},f._encodingQueue=new cC.EncodingQueue,f.connectionId=f.options.connectionId||b.ID_PREFIX+bV.randomToken(),f.label=f.options.label||f.connectionId,f.serialization=f.options.serialization||j.Binary,f.reliable=!!f.options.reliable,f._encodingQueue.on("done",function(a){f._bufferedSend(a)}),f._encodingQueue.on("error",function(){b3.default.error("DC#".concat(f.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),f.close()}),f._negotiator=new cm.Negotiator(f),f._negotiator.startConnection(f.options._payload||{originator:!0}),f}return cG(b,a),Object.defineProperty(b.prototype,"type",{get:function(){return h.Data},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),b.prototype.initialize=function(a){this._dc=a,this._configureDataChannel()},b.prototype._configureDataChannel=function(){var a=this;(!bV.supports.binaryBlob||bV.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){b3.default.log("DC#".concat(a.connectionId," dc connection success")),a._open=!0,a.emit("open")},this.dataChannel.onmessage=function(b){b3.default.log("DC#".concat(a.connectionId," dc onmessage:"),b.data),a._handleDataMessage(b)},this.dataChannel.onclose=function(){b3.default.log("DC#".concat(a.connectionId," dc closed for:"),a.peer),a.close()}},b.prototype._handleDataMessage=function(b){var c=this,d=b.data,e=d.constructor,f=this.serialization===j.Binary||this.serialization===j.BinaryUTF8,g=d;if(f){if(e===Blob){bV.blobToArrayBuffer(d,function(a){var b=bV.unpack(a);c.emit("data",b)});return}if(e===ArrayBuffer)g=bV.unpack(d);else if(e===String){var h=bV.binaryStringToArrayBuffer(d);g=bV.unpack(h)}}else this.serialization===j.JSON&&(g=this.parse(d));if(g.__peerData){this._handleChunk(g);return}a.prototype.emit.call(this,"data",g)},b.prototype._handleChunk=function(a){var b=a.__peerData,c=this._chunkedData[b]||{data:[],count:0,total:a.total};if(c.data[a.n]=a.data,c.count++,this._chunkedData[b]=c,c.total===c.count){delete this._chunkedData[b];var d=new Blob(c.data);this._handleDataMessage({data:d})}},b.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,a.prototype.emit.call(this,"close"))},b.prototype.send=function(b,c){if(!this.open){a.prototype.emit.call(this,"error",Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===j.JSON)this._bufferedSend(this.stringify(b));else if(this.serialization===j.Binary||this.serialization===j.BinaryUTF8){var d=bV.pack(b);if(!c&&d.size>bV.chunkedMTU){this._sendChunks(d);return}bV.supports.binaryBlob?this._bufferedSend(d):this._encodingQueue.enque(d)}else this._bufferedSend(b)},b.prototype._bufferedSend=function(a){(this._buffering||!this._trySend(a))&&(this._buffer.push(a),this._bufferSize=this._buffer.length)},b.prototype._trySend=function(a){var c=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>b.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){c._buffering=!1,c._tryBuffer()},50),!1;try{this.dataChannel.send(a)}catch(d){return b3.default.error("DC#:".concat(this.connectionId," Error when sending:"),d),this._buffering=!0,this.close(),!1}return!0},b.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var a=this._buffer[0];this._trySend(a)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},b.prototype._sendChunks=function(a){var b,c,d=bV.chunk(a);b3.default.log("DC#".concat(this.connectionId," Try to send ").concat(d.length," chunks..."));try{for(var e=cH(d),f=e.next();!f.done;f=e.next()){var g=f.value;this.send(g,!0)}}catch(h){b={error:h}}finally{try{f&&!f.done&&(c=e.return)&&c.call(e)}finally{if(b)throw b.error}}},b.prototype.handleMessage=function(a){var b=a.payload;switch(a.type){case l.Answer:this._negotiator.handleSDP(a.type,b.sdp);break;case l.Candidate:this._negotiator.handleCandidate(b.candidate);break;default:b3.default.warn("Unrecognized message type:",a.type,"from peer:",this.peer)}},b.ID_PREFIX="dc_",b.MAX_BUFFERED_AMOUNT=8388608,b}(cs.BaseConnection),cJ={};bQ(cJ,"API",()=>cN,a=>cN=a);var cK,cL=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(b){f(b)}}function h(a){try{i(d.throw(a))}catch(b){f(b)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},cM=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(a){return function(b){return i([a,b])}}function i(f){if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;switch(d=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===f[0]||2===f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}e[2]&&g.ops.pop(),g.trys.pop();continue}f=b.call(a,g)}catch(h){f=[6,h],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},cN=function(){function a(a){this._options=a}return a.prototype._buildRequest=function(a){var b=this._options.secure?"https":"http",c=this._options,d=c.host,e=c.port,f=c.path,g=c.key,h=new URL("".concat(b,"://").concat(d,":").concat(e).concat(f).concat(g,"/").concat(a));return h.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),h.searchParams.set("version",cf.version),fetch(h.href,{referrerPolicy:this._options.referrerPolicy})},a.prototype.retrieveId=function(){return cL(this,void 0,Promise,function(){var a,b,c;return cM(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(a=d.sent()).status)throw Error("Error. Status:".concat(a.status));return[2,a.text()];case 2:throw b=d.sent(),b3.default.error("Error retrieving ID",b),c="","/"===this._options.path&&this._options.host!==bV.CLOUD_HOST&&(c=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+c);case 3:return[2]}})})},a.prototype.listAllPeers=function(){return cL(this,void 0,Promise,function(){var a,b,c;return cM(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(a=d.sent()).status){if(401===a.status)throw b="",Error("It doesn't look like you have permission to list peers IDs. "+(b=this._options.host===bV.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature."));throw Error("Error. Status:".concat(a.status))}return[2,a.json()];case 2:throw c=d.sent(),b3.default.error("Error retrieving list peers",c),Error("Could not get list peers from the server."+c);case 3:return[2]}})})},a}(),cO=(cK=function(a,b){return(cK=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}cK(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),cP=function(){return(cP=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},cQ=function(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")},cR=function(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(h){e={error:h}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g},cS=function(a){function b(c,d){var e,f=a.call(this)||this;return(f._id=null,f._lastServerId=null,f._destroyed=!1,f._disconnected=!1,f._open=!1,f._connections=new Map,f._lostMessages=new Map,c&&c.constructor==Object?d=c:c&&(e=c.toString()),d=cP({debug:0,host:bV.CLOUD_HOST,port:bV.CLOUD_PORT,path:"/",key:b.DEFAULT_KEY,token:bV.randomToken(),config:bV.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},d),f._options=d,"/"===f._options.host&&(f._options.host=window.location.hostname),f._options.path&&("/"!==f._options.path[0]&&(f._options.path="/"+f._options.path),"/"!==f._options.path[f._options.path.length-1]&&(f._options.path+="/")),void 0===f._options.secure&&f._options.host!==bV.CLOUD_HOST?f._options.secure=bV.isSecure():f._options.host==bV.CLOUD_HOST&&(f._options.secure=!0),f._options.logFunction&&b3.default.setLogFunction(f._options.logFunction),b3.default.logLevel=f._options.debug||0,f._api=new cJ.API(d),f._socket=f._createServerConnection(),bV.supports.audioVideo||bV.supports.data)?e&&!bV.validateId(e)?(f._delayedAbort(i.InvalidID,'ID "'.concat(e,'" is invalid')),f):(e?f._initialize(e):f._api.retrieveId().then(function(a){return f._initialize(a)}).catch(function(a){return f._abort(i.ServerError,a)}),f):(f._delayedAbort(i.BrowserIncompatible,"The current browser does not support WebRTC"),f)}return cO(b,a),Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"connections",{get:function(){var a,b,c=Object.create(null);try{for(var d=cQ(this._connections),e=d.next();!e.done;e=d.next()){var f=cR(e.value,2),g=f[0],h=f[1];c[g]=h}}catch(i){a={error:i}}finally{try{e&&!e.done&&(b=d.return)&&b.call(d)}finally{if(a)throw a.error}}return c},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),b.prototype._createServerConnection=function(){var a=this,b=new cd.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return b.on(k.Message,function(b){a._handleMessage(b)}),b.on(k.Error,function(b){a._abort(i.SocketError,b)}),b.on(k.Disconnected,function(){a.disconnected||(a.emitError(i.Network,"Lost connection to server."),a.disconnect())}),b.on(k.Close,function(){a.disconnected||a._abort(i.SocketClosed,"Underlying socket is already closed.")}),b},b.prototype._initialize=function(a){this._id=a,this.socket.start(a,this._options.token)},b.prototype._handleMessage=function(a){var b,c,d=a.type,e=a.payload,f=a.src;switch(d){case l.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case l.Error:this._abort(i.ServerError,e.msg);break;case l.IdTaken:this._abort(i.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case l.InvalidKey:this._abort(i.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case l.Leave:b3.default.log("Received leave message from ".concat(f)),this._cleanupPeer(f),this._connections.delete(f);break;case l.Expire:this.emitError(i.PeerUnavailable,"Could not connect to peer ".concat(f));break;case l.Offer:var g=e.connectionId,j=this.getConnection(f,g);if(j&&(j.close(),b3.default.warn("Offer received for existing Connection ID:".concat(g))),e.type===h.Media){var k=new cl.MediaConnection(f,this,{connectionId:g,_payload:e,metadata:e.metadata});j=k,this._addConnection(f,j),this.emit("call",k)}else if(e.type===h.Data){var m=new cA.DataConnection(f,this,{connectionId:g,_payload:e,metadata:e.metadata,label:e.label,serialization:e.serialization,reliable:e.reliable});j=m,this._addConnection(f,j),this.emit("connection",m)}else{b3.default.warn("Received malformed connection type:".concat(e.type));return}var n=this._getMessages(g);try{for(var o=cQ(n),p=o.next();!p.done;p=o.next()){var q=p.value;j.handleMessage(q)}}catch(r){b={error:r}}finally{try{p&&!p.done&&(c=o.return)&&c.call(o)}finally{if(b)throw b.error}}break;default:if(!e){b3.default.warn("You received a malformed message from ".concat(f," of type ").concat(d));return}var g=e.connectionId,j=this.getConnection(f,g);j&&j.peerConnection?j.handleMessage(a):g?this._storeMessage(g,a):b3.default.warn("You received an unrecognized message:",a)}},b.prototype._storeMessage=function(a,b){this._lostMessages.has(a)||this._lostMessages.set(a,[]),this._lostMessages.get(a).push(b)},b.prototype._getMessages=function(a){var b=this._lostMessages.get(a);return b?(this._lostMessages.delete(a),b):[]},b.prototype.connect=function(a,b){if(void 0===b&&(b={}),this.disconnected){b3.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(i.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var c=new cA.DataConnection(a,this,b);return this._addConnection(a,c),c},b.prototype.call=function(a,b,c){if(void 0===c&&(c={}),this.disconnected){b3.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(i.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!b){b3.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var d=new cl.MediaConnection(a,this,cP(cP({},c),{_stream:b}));return this._addConnection(a,d),d},b.prototype._addConnection=function(a,b){b3.default.log("add connection ".concat(b.type,":").concat(b.connectionId," to peerId:").concat(a)),this._connections.has(a)||this._connections.set(a,[]),this._connections.get(a).push(b)},b.prototype._removeConnection=function(a){var b=this._connections.get(a.peer);if(b){var c=b.indexOf(a);-1!==c&&b.splice(c,1)}this._lostMessages.delete(a.connectionId)},b.prototype.getConnection=function(a,b){var c,d,e=this._connections.get(a);if(!e)return null;try{for(var f=cQ(e),g=f.next();!g.done;g=f.next()){var h=g.value;if(h.connectionId===b)return h}}catch(i){c={error:i}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}return null},b.prototype._delayedAbort=function(a,b){var c=this;setTimeout(function(){c._abort(a,b)},0)},b.prototype._abort=function(a,b){b3.default.error("Aborting!"),this.emitError(a,b),this._lastServerId?this.disconnect():this.destroy()},b.prototype.emitError=function(a,b){var c;b3.default.error("Error:",b),(c="string"==typeof b?Error(b):b).type=a,this.emit("error",c)},b.prototype.destroy=function(){this.destroyed||(b3.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},b.prototype._cleanup=function(){var a,b;try{for(var c=cQ(this._connections.keys()),d=c.next();!d.done;d=c.next()){var e=d.value;this._cleanupPeer(e),this._connections.delete(e)}}catch(f){a={error:f}}finally{try{d&&!d.done&&(b=c.return)&&b.call(c)}finally{if(a)throw a.error}}this.socket.removeAllListeners()},b.prototype._cleanupPeer=function(a){var b,c,d=this._connections.get(a);if(d)try{for(var e=cQ(d),f=e.next();!f.done;f=e.next())f.value.close()}catch(g){b={error:g}}finally{try{f&&!f.done&&(c=e.return)&&c.call(e)}finally{if(b)throw b.error}}},b.prototype.disconnect=function(){if(!this.disconnected){var a=this.id;b3.default.log("Disconnect peer with ID:".concat(a)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=a,this._id=null,this.emit("disconnected",a)}},b.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)b3.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));else b3.default.error("In a hurry? We're still trying to make the initial connection!")},b.prototype.listAllPeers=function(a){var b=this;void 0===a&&(a=function(a){}),this._api.listAllPeers().then(function(b){return a(b)}).catch(function(a){return b._abort(i.ServerError,a)})},b.DEFAULT_KEY="peerjs",b}(bX.EventEmitter),cT=bW.Peer;class cU{constructor(a){this.mediaRequested=!1,this.onVideoTrackCb=null,this.vdTrack=function(){let a=document.createElement("canvas");a.width=a.height=2;let b=a.getContext("2d");return null==b||b.fillRect(0,0,a.width,a.height),requestAnimationFrame(function c(){null==b||b.fillRect(0,0,a.width,a.height),requestAnimationFrame(c)}),a.captureStream(60).getTracks()[0]}(),this.stream=new MediaStream([a,this.vdTrack])}toggleVideo(){if(!this.mediaRequested)return navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{let b=a.getVideoTracks()[0];if(!b)throw Error("No video track provided");return this.stream.addTrack(b),this.stream.removeTrack(this.vdTrack),this.mediaRequested=!0,this.onVideoTrackCb&&this.onVideoTrackCb(b),!0}).catch(a=>!1);let a=!0;return this.stream.getVideoTracks().forEach(b=>{b.enabled=a=a&&!b.enabled}),Promise.resolve(a)}toggleAudio(){let a=!0;return this.stream.getAudioTracks().forEach(b=>{b.enabled=a=a&&!b.enabled}),a}onVideoTrack(a){this.onVideoTrackCb=a}stop(){this.stream.getTracks().forEach(a=>a.stop())}}class cV{constructor(){this.position=[0,0],this.pScrEl=document.scrollingElement||document.documentElement,this.lastScrEl=null,this.resetLastScrEl=()=>{this.lastScrEl=null},this.handleWScroll=a=>{a.target!==this.lastScrEl&&"window"!==this.lastScrEl&&this.resetLastScrEl()},this.mouse=document.createElement("div"),Object.assign(this.mouse.style,{width:"20px",height:"20px",opacity:".4",borderRadius:"50%",position:"absolute",zIndex:"999998",background:"radial-gradient(red, transparent)"})}mount(){document.body.appendChild(this.mouse),window.addEventListener("scroll",this.handleWScroll),window.addEventListener("resize",this.resetLastScrEl)}move(a){(this.position[0]!==a[0]||this.position[1]!==a[1])&&this.resetLastScrEl(),this.position=a,Object.assign(this.mouse.style,{left:`${a[0]||0}px`,top:`${a[1]||0}px`})}getPosition(){return this.position}click(a){let b=document.elementFromPoint(a[0],a[1]);return b instanceof HTMLElement?(b.click(),b.focus(),b):null}scroll(a){let[b,c]=this.position,[d,e]=a,f=this.lastScrEl;if(f instanceof Element){f.scrollLeft+=d,f.scrollTop+=e;return}if("window"===f){window.scroll(this.pScrEl.scrollLeft+d,this.pScrEl.scrollTop+e);return}for(f=document.elementFromPoint(b-this.pScrEl.scrollLeft,c-this.pScrEl.scrollTop);f;){if(f.scrollHeight>f.clientHeight||f.scrollWidth>f.clientWidth){let g=getComputedStyle(f);if(g.overflow.indexOf("scroll")>=0||g.overflow.indexOf("auto")>=0){let h=f.scrollLeft,i=f.scrollTop;if(f.scrollLeft+=d,f.scrollTop+=e,h!==f.scrollLeft||i!==f.scrollTop){this.lastScrEl=f;return}}}f=f.parentElement}window.scroll(this.pScrEl.scrollLeft+d,this.pScrEl.scrollTop+e),this.lastScrEl="window"}remove(){this.mouse.parentElement&&document.body.removeChild(this.mouse),window.removeEventListener("scroll",this.handleWScroll),window.removeEventListener("resize",this.resetLastScrEl)}}function cW(a,b){if(a instanceof HTMLButtonElement)return a;let c=document.createElement("button");return Object.assign(c.style,{padding:"10px 14px",fontSize:"14px",borderRadius:"3px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",textTransform:"uppercase",marginRight:"10px"},b),"string"==typeof a?c.innerHTML=a:(c.innerHTML=a.innerHTML,Object.assign(c.style,a.style)),c}class cX{constructor(a){this.resolve=()=>{},this.reject=()=>{};let b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("p");d.innerText=a.text;let e=document.createElement("div"),f=cW(a.confirmBtn,{background:"rgba(0, 167, 47, 1)",color:"white"}),g=cW(a.declineBtn,{background:"#FFE9E9",color:"#CC0000"});e.appendChild(f),e.appendChild(g),c.appendChild(d),c.appendChild(e),Object.assign(e.style,{marginTop:"10px",display:"flex",alignItems:"center",backgroundColor:"white",padding:"10px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)",borderRadius:"6px"}),Object.assign(c.style,{font:"14px 'Roboto', sans-serif",position:"relative",pointerEvents:"auto",margin:"4em auto",width:"90%",maxWidth:"fit-content",padding:"20px",background:"#F3F3F3",color:"black",borderRadius:"3px",boxShadow:"0px 0px 3.99778px 1.99889px rgba(0, 0, 0, 0.1)"},a.style),Object.assign(b.style,{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:2147483646}),b.appendChild(c),this.wrapper=b,f.onclick=()=>{this._remove(),this.resolve(!0)},g.onclick=()=>{this._remove(),this.resolve(!1)}}mount(){return document.body.appendChild(this.wrapper),new Promise((a,b)=>{this.resolve=a,this.reject=b})}_remove(){this.wrapper.parentElement&&document.body.removeChild(this.wrapper)}remove(){this._remove(),this.reject()}}let cY=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
<path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
</svg>`,cZ=cY.replace('fill="#ef5261"','fill="green"'),c$="Reject",c_=`${cZ} &#xa0 Answer`;function c0(a,b,c,d){let e="string"==typeof a;return Object.assign({text:e?a:d,confirmBtn:b,declineBtn:c},e?void 0:a)}let c1=a=>c0(a,c_,c$,"You have an incoming call. Do you want to answer?"),c2=a=>c0(a,"Grant Remote Control",c$,"Agent requested remote control. Allow?");(d=m||(m={}))[d.Disabled=0]="Disabled",d[d.Requesting=1]="Requesting",d[d.Enabled=2]="Enabled";let c3=function(a){this.value=a},c4=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value");c4&&c4.set&&(c3=c4.set);class c5{constructor(a,b,c){this.options=a,this.onGrand=b,this.onRelease=c,this.status=m.Disabled,this.agentID=null,this.confirm=null,this.requestControl=a=>{if(null!==this.agentID){this.releaseControl(a);return}setTimeout(()=>{this.status===m.Requesting&&this.releaseControl(a)},3e4),this.agentID=a,this.status=m.Requesting,this.confirm=new cX(c2(this.options.controlConfirm)),this.confirm.mount().then(b=>{b?this.grantControl(a):this.releaseControl(a)}).catch()},this.grantControl=a=>{this.agentID=a,this.status=m.Enabled,this.mouse=new cV,this.mouse.mount(),sessionStorage.setItem(this.options.session_control_peer_key,a),this.onGrand(a)},this.releaseControl=a=>{var b,c;this.agentID===a&&(null===(b=this.confirm)|| void 0===b||b.remove(),null===(c=this.mouse)|| void 0===c||c.remove(),this.mouse=null,this.status=m.Disabled,this.agentID=null,sessionStorage.removeItem(this.options.session_control_peer_key),this.onRelease(a))},this.scroll=(a,b)=>{var c;a===this.agentID&&(null===(c=this.mouse)|| void 0===c||c.scroll(b))},this.move=(a,b)=>{var c;a===this.agentID&&(null===(c=this.mouse)|| void 0===c||c.move(b))},this.focused=null,this.click=(a,b)=>{a===this.agentID&&this.mouse&&(this.focused=this.mouse.click(b))},this.focus=(a,b)=>{this.focused=b},this.input=(a,b)=>{if(a===this.agentID&&this.mouse&&this.focused){if(this.focused instanceof HTMLTextAreaElement||this.focused instanceof HTMLInputElement){c3.call(this.focused,b);let c=new Event("input",{bubbles:!0});this.focused.dispatchEvent(c)}else this.focused.isContentEditable&&(this.focused.innerText=b)}}}reconnect(a){let b=sessionStorage.getItem(this.options.session_control_peer_key);null!==b&& -1!==a.indexOf(b)?this.grantControl(b):sessionStorage.removeItem(this.options.session_control_peer_key)}}let c6="__openreplay_assist_call_start_ts";class c7{constructor(){this.vRemote=null,this.vLocal=null,this.audioBtn=null,this.videoBtn=null,this.endCallBtn=null,this.agentNameElem=null,this.videoContainer=null,this.vPlaceholder=null,this.aRemote=null,this.localStream=null,this.videoRequested=!1;let a=this.iframe=document.createElement("iframe");Object.assign(a.style,{position:"fixed",zIndex:2147483646,border:"none",bottom:"10px",right:"10px",height:"200px",width:"200px"}),a.setAttribute("data-openreplay-obscured",""),a.setAttribute("data-openreplay-hidden",""),a.setAttribute("data-openreplay-ignore",""),document.body.appendChild(a);let b=a.contentDocument;if(!b){console.error("OpenReplay: CallWindow iframe document is not reachable.");return}let c="https://static.openreplay.com/tracker-assist/3.4.4";this.load=fetch(c+"/index.html").then(a=>a.text()).then(d=>{a.onload=()=>{let c=b.getElementById("or-assist");null==c||c.classList.remove("status-connecting"),this.adjustIframeSize(),a.onload=null},d=d.replace(/href="css/g,`href="${c}/css`),b.open(),b.write(d),b.close(),this.vLocal=b.getElementById("video-local"),this.vRemote=b.getElementById("video-remote"),this.videoContainer=b.getElementById("video-container"),this.audioBtn=b.getElementById("audio-btn"),this.audioBtn&&(this.audioBtn.onclick=()=>this.toggleAudio()),this.videoBtn=b.getElementById("video-btn"),this.videoBtn&&(this.videoBtn.onclick=()=>this.toggleVideo()),this.endCallBtn=b.getElementById("end-call-btn"),this.agentNameElem=b.getElementById("agent-name"),this.vPlaceholder=b.querySelector("#remote-stream p");let e=b.getElementById("duration");if(e){let f=Number(sessionStorage.getItem(c6))||Date.now();sessionStorage.setItem(c6,f.toString()),this.tsInterval=setInterval(()=>{let a=Date.now()-f,b=~~(a/1e3),c=~~(b/60),d=b-60*c;e.innerText=`${c}:${d<10?0:""}${d}`},500)}let g=b.querySelector(".drag-area");g&&function(a,b,c){b.addEventListener("pointerdown",function(b){e=b.clientX,f=b.clientY,d=a.getBoundingClientRect(),c.addEventListener("pointermove",j,{passive:!0}),c.addEventListener("pointerup",l,{passive:!0}),c.addEventListener("pointercancel",l,{passive:!0})},{passive:!0});let d,e,f,g,h=0,i=0;function j(a){g||(h+=a.clientX-e,i+=a.clientY-f,h=Math.min(Math.max(h,-d.left),window.innerWidth-d.right),i=Math.min(Math.max(i,-d.top),window.innerHeight-d.bottom),g=requestAnimationFrame(k))}function k(){a.style.transform="translate3d("+h+"px,"+i+"px, 0px)",g=null}function l(){c.removeEventListener("pointermove",j),c.removeEventListener("pointerup",l),c.removeEventListener("pointercancel",l),g&&(cancelAnimationFrame(g),g=null),a.style.left=d.left+h+"px",a.style.top=d.top+i+"px",a.style.transform="translate3d(0px,0px,0px)",h=i=0}}(a,g,b.documentElement)})}adjustIframeSize(){let a=this.iframe.contentDocument;a&&(this.iframe.style.height=a.body.scrollHeight+"px",this.iframe.style.width=a.body.scrollWidth+"px")}setCallEndAction(a){this.load.then(()=>{this.endCallBtn&&(this.endCallBtn.onclick=a)})}setRemoteStream(a){this.load.then(()=>{this.vRemote&&!this.vRemote.srcObject&&(this.vRemote.srcObject=a,this.vPlaceholder&&(this.vPlaceholder.innerText="Video has been paused. Click anywhere to resume."),this.aRemote=document.createElement("audio"),this.aRemote.autoplay=!0,this.aRemote.style.display="none",this.aRemote.srcObject=a,document.body.appendChild(this.aRemote)),this.checkRemoteVideoInterval&&clearInterval(this.checkRemoteVideoInterval);let b=!1;this.checkRemoteVideoInterval=setInterval(()=>{var c;let d=null===(c=a.getVideoTracks()[0])|| void 0===c?void 0:c.getSettings(),e=!!d&&(2===d.width||0===d.frameRate),f=!e;b!==f&&this.toggleRemoteVideoUI(b=f)},1e3)})}toggleRemoteVideoUI(a){this.load.then(()=>{this.videoContainer&&(a?this.videoContainer.classList.add("remote"):this.videoContainer.classList.remove("remote"),this.adjustIframeSize())})}setLocalStream(a){this.localStream=a}playRemote(){this.vRemote&&this.vRemote.play()}setAssistentName(a){this.load.then(()=>{this.agentNameElem&&(this.agentNameElem.innerText=a)})}toggleAudioUI(a){this.audioBtn&&(a?this.audioBtn.classList.remove("muted"):this.audioBtn.classList.add("muted"))}toggleAudio(){var a;let b=(null===(a=this.localStream)|| void 0===a?void 0:a.toggleAudio())||!1;this.toggleAudioUI(b)}toggleVideoUI(a){this.videoBtn&&this.videoContainer&&(a?(this.videoContainer.classList.add("local"),this.videoBtn.classList.remove("off")):(this.videoContainer.classList.remove("local"),this.videoBtn.classList.add("off")),this.adjustIframeSize())}toggleVideo(){var a;null===(a=this.localStream)|| void 0===a||a.toggleVideo().then(a=>{this.toggleVideoUI(a),this.load.then(()=>{this.vLocal&&this.localStream&&!this.vLocal.srcObject&&(this.vLocal.srcObject=this.localStream.stream)})})}remove(){var a;null===(a=this.localStream)|| void 0===a||a.stop(),clearInterval(this.tsInterval),clearInterval(this.checkRemoteVideoInterval),this.iframe.parentElement&&document.body.removeChild(this.iframe),this.aRemote&&this.aRemote.parentElement&&document.body.removeChild(this.aRemote),sessionStorage.removeItem(c6)}}class c8{constructor(){this.ctx=null,this.painting=!1,this.resizeCanvas=()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight},this.lastPosition=[0,0],this.start=a=>{this.painting=!0,this.clrTmID&&clearTimeout(this.clrTmID),this.lastPosition=a},this.stop=()=>{this.painting&&(this.painting=!1,this.fadeOut())},this.move=a=>{this.ctx&&this.painting&&(this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.moveTo(this.lastPosition[0],this.lastPosition[1]),this.ctx.lineTo(a[0],a[1]),this.ctx.lineWidth=8,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle="red",this.ctx.stroke(),this.lastPosition=a)},this.clrTmID=null,this.canvas=document.createElement("canvas"),Object.assign(this.canvas.style,{position:"fixed",left:0,top:0,pointerEvents:"none",zIndex:2147483645})}fadeOut(){let a,b=()=>{this.ctx&&!this.painting&&(this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over",a=setTimeout(b,100))};this.clrTmID=setTimeout(()=>{clearTimeout(a),this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},4e3),b()}mount(){document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resizeCanvas),this.resizeCanvas()}remove(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),window.removeEventListener("resize",this.resizeCanvas)}}(e=n||(n={}))[e.Requesting=0]="Requesting",e[e.True=1]="True",e[e.False=2]="False";class c9{constructor(a,b,c=!1){if(this.app=a,this.noSecureMode=c,this.version="3.5.15",this.socket=null,this.peer=null,this.assistDemandedRestart=!1,this.callingState=n.False,this.agents={},this.onRemoteCallEnd=()=>{},this.options=Object.assign({session_calling_peer_key:"__openreplay_calling_peer",session_control_peer_key:"__openreplay_control_peer",config:null,onCallStart:()=>{},onAgentConnect:()=>{},onRemoteControlStart:()=>{},callConfirm:{},controlConfirm:{}},b),void 0!==document.hidden){let d=()=>this.emit("UPDATE_SESSION",{active:!document.hidden});a.attachEventListener(document,"visibilitychange",d,!1,!1)}let e=document.querySelector("title"),f=e&&new MutationObserver(()=>{this.emit("UPDATE_SESSION",{pageTitle:document.title})});a.attachStartCallback(()=>{!this.assistDemandedRestart&&(this.onStart(),f&&f.observe(e,{subtree:!0,characterData:!0,childList:!0}))}),a.attachStopCallback(()=>{!this.assistDemandedRestart&&(this.clean(),f&&f.disconnect())}),a.attachCommitCallback(a=>{this.agentsConnected&&(2!==a.length||0!==a[0]._id||49!==a[1]._id)&&this.emit("messages",a)}),a.session.attachUpdateCallback(a=>this.emit("UPDATE_SESSION",a))}emit(a,...b){this.socket&&this.socket.emit(a,...b)}get agentsConnected(){return Object.keys(this.agents).length>0}notifyCallEnd(){this.emit("call_end")}onStart(){let a=this.app,b=`${a.getProjectKey()}-${a.getSessionID()}`,c=this.socket=aR(a.getHost(),{path:"/ws-assist/socket",query:{peerId:b,identity:"session",sessionInfo:JSON.stringify(Object.assign({pageTitle:document.title,active:!0},this.app.getSessionInfo()))},transports:["websocket"]});c.onAny((...b)=>a.debug.log("Socket:",...b));let d=new c5(this.options,a=>{this.agents[a].onControlReleased=this.options.onRemoteControlStart(),this.emit("control_granted",a),(e=new c8).mount()},a=>{let b=this.agents[a].onControlReleased;delete this.agents[a].onControlReleased,"function"==typeof b&&b(),this.emit("control_rejected",a),null!=e&&(e.remove(),e=null)});c.on("request_control",d.requestControl),c.on("release_control",d.releaseControl),c.on("scroll",d.scroll),c.on("click",d.click),c.on("move",d.move),c.on("focus",(b,c)=>{let e=a.nodes.getNode(c);e instanceof HTMLElement&&d.focus(b,e)}),c.on("input",d.input);let e=null;c.on("moveAnnotation",(a,b)=>e&&e.move(b)),c.on("startAnnotation",(a,b)=>e&&e.start(b)),c.on("stopAnnotation",()=>e&&e.stop()),c.on("NEW_AGENT",(a,b)=>{this.agents[a]=Object.assign({onDisconnect:this.options.onAgentConnect&&this.options.onAgentConnect()},b),this.assistDemandedRestart=!0,this.app.stop(),this.app.start().then(()=>{this.assistDemandedRestart=!1})}),c.on("AGENTS_CONNECTED",a=>{a.forEach(a=>{this.agents[a]={onDisconnect:this.options.onAgentConnect&&this.options.onAgentConnect()}}),this.assistDemandedRestart=!0,this.app.stop(),this.app.start().then(()=>{this.assistDemandedRestart=!1}),d.reconnect(a)});let f=null;c.on("AGENT_DISCONNECTED",a=>{d.releaseControl(a),h===a&&(null==f||f.remove(),this.onRemoteCallEnd()),this.agents[a]&&null!=this.agents[a].onDisconnect&&this.agents[a].onDisconnect(),delete this.agents[a]}),c.on("NO_AGENT",()=>{this.agents={}}),c.on("call_end",()=>this.onRemoteCallEnd());let g="",h="";c.on("_agent_name",(a,b)=>{g=b,h=a});let i={host:a.getHost(),path:"/assist",port:"http:"===location.protocol&&this.noSecureMode?80:443};this.options.config&&(i.config=this.options.config);let j=this.peer=new cT(b,i);j.on("error",b=>a.debug.warn("Peer error: ",b.type,b)),j.on("disconnected",()=>j.reconnect()),j.on("call",b=>{if(a.debug.log("Call: ",b),this.callingState!==n.False){b.close(),a.debug.warn("Call closed instantly bacause line is busy. CallingState: ",this.callingState);return}let c=a=>{a===n.True?sessionStorage.setItem(this.options.session_calling_peer_key,b.peer):a===n.False&&sessionStorage.removeItem(this.options.session_calling_peer_key),this.callingState=a},d,h=sessionStorage.getItem(this.options.session_calling_peer_key);h===b.peer?d=Promise.resolve(!0):(c(n.Requesting),d=(f=new cX(c1(this.options.callConfirm||{text:this.options.confirmText,style:this.options.confirmStyle}))).mount(),this.playNotificationSound(),this.onRemoteCallEnd=()=>{a.debug.log("Received call_end during confirm window opened"),null==f||f.remove(),c(n.False),b.close()},setTimeout(()=>{this.callingState===n.Requesting&&(b.close(),null==f||f.remove(),this.notifyCallEnd(),c(n.False))},3e4)),d.then(d=>{if(!d){b.close(),this.notifyCallEnd(),c(n.False);return}let f=new c7;(e=new c8).mount(),f.setAssistentName(g);let h=this.options.onCallStart(),i=()=>{a.debug.log("Handle Call End"),b.close(),f.remove(),e&&e.remove(),e=null,c(n.False),h&&h()},j=()=>{this.notifyCallEnd(),i()};this.onRemoteCallEnd=i,b.on("error",b=>{a.debug.warn("Call error:",b),j()}),navigator.mediaDevices.getUserMedia({audio:!0}).then(a=>{let b=a.getAudioTracks()[0];if(!b)throw Error("No audio tracks provided");return new cU(b)}).then(d=>{b.on("stream",function(a){f.setRemoteStream(a);let b=()=>{f.playRemote(),document.removeEventListener("click",b)};document.addEventListener("click",b)}),d.onVideoTrack(c=>{let d=b.peerConnection.getSenders().find(a=>{var b;return(null===(b=a.track)|| void 0===b?void 0:b.kind)==="video"});if(!d){a.debug.warn("No video sender found");return}a.debug.log("sender found:",d),d.replaceTrack(c)}),f.setCallEndAction(j),f.setLocalStream(d),b.answer(d.stream),c(n.True)}).catch(b=>{a.debug.warn("Audio mediadevice request error:",b),j()})}).catch()})}playNotificationSound(){"Audio"in window&&new Audio("https://static.openreplay.com/tracker-assist/notification.mp3").play().catch(a=>{this.app.debug.warn(a)})}clean(){this.peer&&(this.peer.destroy(),this.app.debug.log("Peer destroyed")),this.socket&&(this.socket.disconnect(),this.app.debug.log("Socket disconnected"))}}function da(a){return function(b,c={}){var d;if(null===b||!(null===(d=null==navigator?void 0:navigator.mediaDevices)|| void 0===d?void 0:d.getUserMedia))return;if(!b.checkRequiredVersion||!b.checkRequiredVersion("3.5.14")){console.warn("OpenReplay Assist: couldn't load. The minimum required version of @openreplay/tracker@3.5.14 is not met");return}b.notify.log("OpenReplay Assist initializing.");let e=new c9(b,a,c.__DISABLE_SECURE_MODE);return b.debug.log(e),e}}}}])
//# sourceMappingURL=630.efab822e9446754b.js.map